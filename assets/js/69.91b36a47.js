(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{491:function(t,e,a){"use strict";a.r(e);var n=a(70),s=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"微信小程序云开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#微信小程序云开发"}},[t._v("#")]),t._v(" 微信小程序云开发")]),t._v(" "),a("h2",{attrs:{id:"起步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#起步"}},[t._v("#")]),t._v(" 起步")]),t._v(" "),a("p",[t._v("微信公众平台注册、下载开发者工具等")]),t._v(" "),a("h2",{attrs:{id:"云开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#云开发"}},[t._v("#")]),t._v(" 云开发")]),t._v(" "),a("p",[t._v("创建时勾选")]),t._v(" "),a("p",[t._v("进工具 左上角点云开发 一步步开通")]),t._v(" "),a("p",[t._v("重新编译")]),t._v(" "),a("p",[t._v("一般要等个几分钟")]),t._v(" "),a("h2",{attrs:{id:"app-json"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#app-json"}},[t._v("#")]),t._v(" app.json")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("page添加页面，会自动生成对应文件")])]),t._v(" "),a("li",[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('"window": {\n    "backgroundColor": "#F6F6F6",\n    "backgroundTextStyle": "light",\n    "navigationBarBackgroundColor": "#d43c33",\n    "navigationBarTitleText": "音乐",\n    "navigationBarTextStyle": "white"\n  },\n  一看就懂 不用注释\n')])])])]),t._v(" "),a("li",[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('"tabBar": {\n    "color": "#474747",\n    "selectedColor": "#d43c43",\n    "list": [\n      {\n        "pagePath": "pages/playlist/playlist",\n        "text": "音乐",\n        "iconPath": "images/music.png",\n        "selectedIconPath": "images/music-actived.png"\n      },\n      {\n        "pagePath": "pages/blog/blog",\n        "text": "发现",\n        "iconPath": "images/blog.png",\n        "selectedIconPath": "images/blog-actived.png"\n      },\n      {\n        "pagePath": "pages/profile/profile",\n        "text": "我的",\n        "iconPath": "images/profile.png",\n        "selectedIconPath": "images/profile-actived.png"\n      }\n    ]\n  },\n  同一看就懂\n')])])])]),t._v(" "),a("li",[a("p",[t._v("全局属性")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("this.globalData = {\n      playingMusicId: -1,\n      openid: -1\n    }\n")])])]),a("p",[t._v("写全局方法去get\\set")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("setPlayMusicId(playingMusicId) {\n    this.globalData.playingMusicId = playingMusicId\n  },\n  getPlayMusicId() {\n    return this.globalData.playingMusicId\n  },\n")])])]),a("p",[t._v("在页面中获取")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const app = getApp()\n\napp.xx即可\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"dom绑定事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dom绑定事件"}},[t._v("#")]),t._v(" Dom绑定事件")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('class="musiclist-container {{item.id === playingId ? \'playing\': \'\'}}" \n动态class直接跟着写\n\nbind:tap="onSelect" \n不能括号传参 要用tab事件 click有300ms延迟？猜测 没去查\n\n传参方式 设置attribute\ndata-musicid="{{item.id}}" \ndata-index="{{index}}"\n\n在方法里获取\nconst musicId = event.currentTarget.dataset.musicid\nconst index = event.currentTarget.dataset.index\n')])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("bind:catch 捕获\n")])])]),a("h2",{attrs:{id:"禁止页面滚动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#禁止页面滚动"}},[t._v("#")]),t._v(" 禁止页面滚动")]),t._v(" "),a("p",[t._v("对应页面json中")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('"disableScroll": true\n')])])]),a("h2",{attrs:{id:"暂停动画"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#暂停动画"}},[t._v("#")]),t._v(" 暂停动画")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("animation-play-state: paused;\n")])])]),a("h2",{attrs:{id:"获取openid并存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取openid并存储"}},[t._v("#")]),t._v(" 获取openid并存储")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("getOpenId () {\n    wx.cloud.callFunction({\n      name: 'login'\n    }).then(res => {\n      const openid = res.result.openid\n      this.globalData.openid = openid\n      if (wx.getStorageSync(openid) === '') {\n        wx.setStorageSync(openid, [])\n      }\n    })\n  }\n  \n  在app.js中调用即可\n")])])]),a("h2",{attrs:{id:"app-wsxx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#app-wsxx"}},[t._v("#")]),t._v(" app.wsxx")]),t._v(" "),a("p",[t._v("全局样式")]),t._v(" "),a("p",[t._v('引入别的样式 @import "xx.wsxx"')]),t._v(" "),a("h2",{attrs:{id:"轮播图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#轮播图"}},[t._v("#")]),t._v(" 轮播图")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<swiper indicator-dots="true" autoplay="true" interval="2000" duration="200" circular="true">\n  <block wx:for="{{swiperImgUrls}}" wx:key="item.fileid">\n    <swiper-item>\n      <image src="{{item.fileid}}" mode="widthFix" class="img"></image>\n    </swiper-item>\n  </block>\n</swiper>\n')])])]),a("p",[t._v("建议用block包裹")]),t._v(" "),a("p",[t._v("image标签可以直接获取到云文件的图片 fileid")]),t._v(" "),a("p",[t._v("wx:key里的参数不用加{{}}")]),t._v(" "),a("h2",{attrs:{id:"全局音乐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局音乐"}},[t._v("#")]),t._v(" 全局音乐")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("app.json")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('"requiredBackgroundModes": [\n\n    "audio"\n\n ],\n')])])])]),t._v(" "),a("li",[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const backgroundAudioManager = wx.getBackgroundAudioManager()\n")])])])]),t._v(" "),a("li",[a("p",[t._v("绑定事件")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("_bindBGMEvent () {\n      backgroundAudioManager.onPlay(() => {\n        isMoving = false\n        this.triggerEvent('musicPlay')\n      })\n\n      backgroundAudioManager.onStop(() => {\n        console.log()\n      })\n\n      backgroundAudioManager.onPause(() => {\n        this.triggerEvent('musicPause')\n      })\n\n      backgroundAudioManager.onWaiting(() => {\n        console.log()\n      })\n\n      backgroundAudioManager.onCanplay(() => {\n        if (typeof backgroundAudioManager.duration !== 'undefined') {\n          this._setTime()\n        } else {\n          setTimeout(() => {\n            this._setTime()\n          }, 1000)\n        }\n      })\n\n      backgroundAudioManager.onTimeUpdate(() => {\n        if (!isMoving) {\n          const currentTime = backgroundAudioManager.currentTime\n          const currentTimeFmt = this._dateFormat(currentTime)\n          const percent = currentTime / backgroundAudioManager.duration\n          const sec = currentTime.toString().split('.')[0]\n          if (currentSec !== sec) {\n            this.setData({\n              ['showTime.currentTime']: `${currentTimeFmt.min}:${currentTimeFmt.sec}`,\n              movableDis: percent * (movableAreaWidth - movableViewWidth),\n              progress: percent * 100\n            })\n            currentSec = sec\n            this.triggerEvent('timeUpdate', {\n              currentTime\n            })\n          }\n        }\n      })\n\n      backgroundAudioManager.onEnded(() => {\n        this.triggerEvent('musicEnd')\n      })\n\n      backgroundAudioManager.onError((res) => {\n        console.log(res.errMsg)\n        console.log(res.errCode)\n        wx.showToast({\n          title: '错误:' + res.errCode,\n        })\n      })\n    },\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"获取dom元素"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取dom元素"}},[t._v("#")]),t._v(" 获取dom元素")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("\t  const query = this.createSelectorQuery()\n      query.select('.movable-area').boundingClientRect()\n      query.select('.movable-view').boundingClientRect()\n      query.exec(rect => {\n        console.log(rect)\n        movableAreaWidth = rect[0].width\n        movableViewWidth = rect[1].width\n      })\n")])])]),a("h2",{attrs:{id:"组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#组件"}},[t._v("#")]),t._v(" 组件")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("在对应页面的json文件中加上")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('"usingComponents": {\n    "x-playlist": "/components/playlist/playlist"\n  },\n')])])])]),t._v(" "),a("li",[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("properties: {\n    playlist: {\n      type: Object\n    },\n    text: {\n    \ttype: String,\n    \tvalue: ''\n    }\n  },\n")])])]),a("p",[t._v("跟vue prop类似 注意default 改为value")])]),t._v(" "),a("li",[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("observers: {\n    ['playlist.playCount'](count) {\n      this.setData({\n        _count: this._tranNumber(count, 2)\n      })\n    }\n  },\n 类似watch\n 可以观察到对象中的属性\n")])])])]),t._v(" "),a("li",[a("p",[t._v("分发事件")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("this.triggerEvent('search', {\n        keyword\n      })\nbind:musicEnd=\"XX\"\nkeyword = event.detail.keyword\n\n原生事件\nbindtouchend 没冒号\n")])])])]),t._v(" "),a("li",[a("p",[t._v("生命周期")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("lifetimes: {\n    ready() { // 钩子\n      wx.getSystemInfo({\n        success: function(res) {\n          lyricHeight = res.screenWidth / 750 * 65\n        },\n      })\n    }\n  },\n")])])])]),t._v(" "),a("li",[a("p",[t._v("获取外界css")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("externalClasses: [\n    'iconfont',\n    'icon-sousuo'\n  ],\n  \n 组件标签上\n iconfont=\"iconfont\" icon-sousuo=\"icon-sousuo\"\n")])])])]),t._v(" "),a("li",[a("p",[t._v("插槽")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<slot name="modal-content"></slot>\n\n<view slot="modal-content">\n    <button class="login"\n      open-type="getUserInfo"\n      bindgetuserinfo="onGotUserInfo"\n    >获取微信授权信息</button>\n  </view>\n')])])])])]),t._v(" "),a("h2",{attrs:{id:"设置页面标题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置页面标题"}},[t._v("#")]),t._v(" 设置页面标题")]),t._v(" "),a("ol",[a("li",[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("动态设置\nwx.setNavigationBarTitle({\n      title: music.name\n    })\n")])])])]),t._v(" "),a("li",[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('对应json\n"navigationBarTitleText": "正文"\n')])])])])]),t._v(" "),a("h2",{attrs:{id:"获取用户信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取用户信息"}},[t._v("#")]),t._v(" 获取用户信息")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("open-data 页面直接显示 只能显示自己的")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<open-data type="userNickName"></open-data>\n<open-data type="userAvatarUrl"></open-data>\n')])])])]),t._v(" "),a("li",[a("p",[t._v("wx.getUserInfo() 不支持弹出授权")])]),t._v(" "),a("li",[a("p",[t._v("button open-type 没openid")])]),t._v(" "),a("li",[a("p",[t._v("云开发 自带login函数")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wx.getSetting({\n      success: (res) => {\n        console.log(res)\n        if (res.authSetting['scope.userInfo']) {\n          wx.getUserInfo({\n            success: (res) => {\n              console.log(res)\n              this.onLoginSuccess({\n                detail: res.userInfo\n              })\n            }\n          })\n        } else {\n          this.setData({\n            modalShow: true\n          })\n        }\n      }\n    })\n")])])]),a("p",[t._v("用按钮调用")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<button class="login"\n      open-type="getUserInfo"\n      bindgetuserinfo="onGotUserInfo"\n    >获取微信授权信息</button>\n')])])]),a("h2",{attrs:{id:"格式化时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#格式化时间"}},[t._v("#")]),t._v(" 格式化时间")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("module.exports = (date) => {\n  let fmt = 'yyyy-MM-dd hh:mm:ss'\n  const o = {\n    'M+': date.getMonth() + 1, // 月份\n    'd+': date.getDate(), // 日\n    'h+': date.getHours(), // 小时\n    'm+': date.getMinutes(), // 分钟\n    's+': date.getSeconds(), // 秒\n  }\n\n  if (/(y+)/.test(fmt)) {\n    fmt = fmt.replace(RegExp.$1, date.getFullYear())\n  }\n  for (let k in o) {\n    if (new RegExp('(' + k + ')').test(fmt)) {\n      fmt = fmt.replace(RegExp.$1, o[k].toString().length == 1 ? '0' + o[k] : o[k])\n    }\n  }\n\n  // console.log(fmt)\n  return fmt\n}\n")])])]),a("p",[t._v("替换模板获得对应格式")]),t._v(" "),a("h2",{attrs:{id:"跳转页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跳转页面"}},[t._v("#")]),t._v(" 跳转页面")]),t._v(" "),a("ol",[a("li",[t._v("js")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wx.navigateTo({\n        url: `../../pages/musiclist/musiclist?playlistId=${this.properties.playlist.id}`,\n})\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wx.navigateBack({})\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[t._v("路由")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<navigator class="content" hover-class="none" url="/pages/profile-playhistory/profile-playhistory">\n      <i class="iconfont icon-ziyuanldpi"></i>\n      <text class="text">最近播放</text>\n      <i class="iconfont icon-xiangyou"></i>\n    </navigator>\n')])])])])]),t._v(" "),a("h2",{attrs:{id:"格式化播放次数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#格式化播放次数"}},[t._v("#")]),t._v(" 格式化播放次数")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/**\n * point保留小数位\n */\n_tranNumber(num, point) {\n      let numStr = num.toString().split('.')[0]\n      if (numStr.length < 6) {\n        return numStr\n      } else if (numStr.length >= 6 && numStr.length <=8 ) {\n        let decimal = numStr.substring(numStr.length - 4, numStr.length - 4 - point)\n        return parseFloat(parseInt(num / 10000) + '.' + decimal) + '万'\n      } else if (numStr.length > 8) {\n        let decimal = numStr.substring(numStr.length - 8, numStr.length - 8 - point)\n        return parseFloat(parseInt(num / 100000000) + '.' + decimal) + '亿'\n      }\n}\n")])])]),a("h2",{attrs:{id:"高斯模糊"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高斯模糊"}},[t._v("#")]),t._v(" 高斯模糊")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(".detail-container {\n  height: 320rpx;\n  filter: blur(40rpx);\n  opacity: 0.4;\n}\n")])])]),a("p",[t._v("底下再用定位盖一层底色")]),t._v(" "),a("h2",{attrs:{id:"storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#storage"}},[t._v("#")]),t._v(" storage")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wx.setStorageSync('musiclist', this.data.musiclist)\n\nwx.getStorageSync('musiclist')\n")])])]),a("p",[t._v("有分同步异步")]),t._v(" "),a("h2",{attrs:{id:"上拉加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上拉加载"}},[t._v("#")]),t._v(" 上拉加载")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("在对应页面的json文件中加上")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('"enablePullDownRefresh": true\n')])])])]),t._v(" "),a("li",[a("p",[t._v("在钩子中")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("onReachBottom: function () {\n    this._getPLaylist()\n  },\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"下拉刷新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下拉刷新"}},[t._v("#")]),t._v(" 下拉刷新")]),t._v(" "),a("p",[t._v("在对应钩子里")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("onPullDownRefresh: function () {\n    this.setData({\n      playlist: []\n    })\n    this._getPLaylist()\n    this._getSwiper()\n  },\n")])])]),a("p",[t._v("获取到数据后")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wx.stopPullDownRefresh()\n")])])]),a("p",[t._v("将上方加载动画收回")]),t._v(" "),a("h2",{attrs:{id:"全局组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局组件"}},[t._v("#")]),t._v(" 全局组件")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("loading")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wx.showLoading({\n      title: '加载中'\n        mask: true,\n})\nwx.hideLoading()\n")])])])]),t._v(" "),a("li",[a("p",[t._v("modal")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wx.showModal({\n      title: '授权用户才能发布',\n      content: '',\n    })\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"配置分享"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置分享"}},[t._v("#")]),t._v(" 配置分享")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("在钩子函数\nonShareAppMessage: function (event) {\n    let blogObj = event.target.dataset.blog\n    return {\n      title: blogObj.content,\n      path: `/pages/blog-comment/blog-comment?blogId=${blogObj._id}`\n    }\n  }\n")])])]),a("h3",{attrs:{id:"按钮触发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#按钮触发"}},[t._v("#")]),t._v(" 按钮触发")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<button open-type="share" data-blogid="{{blogId}}" data-blog="{{blog}}" class="share-btn" hover-class="share-hover">\n      <i class="iconfont icon-fenxiang icon"></i>\n      <text>分享</text>\n    </button>\n')])])]),a("h2",{attrs:{id:"图片"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图片"}},[t._v("#")]),t._v(" 图片")]),t._v(" "),a("h3",{attrs:{id:"上传"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传"}},[t._v("#")]),t._v(" 上传")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wx.chooseImage({\n      count: MAX_IMG_NUM - this.data.images.length,\n      sizeType: ['orginal', 'compressed'],\n      sourceType: ['album', 'camera'],\n      success: (res) => {\n        console.log(res)\n        this.setData({\n          images: this.data.images.concat(res.tempFilePaths),\n        })\n        this.showAddImg()\n      },\n    })\n")])])]),a("h3",{attrs:{id:"预览"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预览"}},[t._v("#")]),t._v(" 预览")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wx.previewImage({\n      urls: this.data.images,\n      current: event.target.dataset.imgsrc\n    })\n")])])]),a("h3",{attrs:{id:"上传到云存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传到云存储"}},[t._v("#")]),t._v(" 上传到云存储")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wx.cloud.uploadFile({\n          cloudPath: 'blog/' + Date.now() + '-' + Math.random() * 10000000 + suffix,\n          filePath: item,\n          success: (res) => {\n            // console.log(res)\n            fileIds = fileIds.concat(res.fileID)\n            resolve(res)\n          },\n          fail: err => {\n            console.log(err)\n            reject(err)\n          }\n        })\n")])])]),a("h2",{attrs:{id:"获取上一页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取上一页面"}},[t._v("#")]),t._v(" 获取上一页面")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const pages = getCurrentPages()\n        const prevPage = pages[pages.length - 2]\n        prevPage.onPullDownRefresh()\n")])])]),a("h2",{attrs:{id:"配置订阅消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置订阅消息"}},[t._v("#")]),t._v(" 配置订阅消息")]),t._v(" "),a("h3",{attrs:{id:"dom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dom"}},[t._v("#")]),t._v(" dom")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<form slot="modal-content" report-submit="true" bind:submit="onSend">\n    <textarea name="content" class="comment-content" placeholder="写评论" value="{{content}}" fixed="true"></textarea>\n    <button class="send" form-type="submit">发送</button>\n  </form>\n')])])]),a("h3",{attrs:{id:"点击获取权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#点击获取权限"}},[t._v("#")]),t._v(" 点击获取权限")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wx.requestSubscribeMessage({\n        tmplIds: ['ygpQMok-53skEfgTXGMNEX3lBCAVNFKasRLvDnE-y5U'],\n        success(res) {\n        }\n      })\n")])])]),a("h3",{attrs:{id:"云函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#云函数"}},[t._v("#")]),t._v(" 云函数")]),t._v(" "),a("p",[t._v("config.json")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n  "permissions": {\n    "openapi": [\n      "subscribeMessage.send"\n    ]\n  }\n}\n\n')])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const { OPENID } = cloud.getWXContext()\n  const db = cloud.database()\n  try {\n    const result = await cloud.openapi.subscribeMessage.send({\n      touser: OPENID,\n      page: `/pages/blog-comment/blog-comment?blogId=${event.blogId}`,\n      data: {\n        phrase2: {\n          value: event.content\n        },\n        time1: {\n          value: fmtTime(new Date())\n        }\n      },\n      templateId: 'ygpQMok-53skEfgTXGMNEX3lBCAVNFKasRLvDnE-y5U'\n    })\n    console.log(result)\n    return result\n  } catch (err) {\n    console.log(err)\n    return err\n  }\n")])])]),a("h2",{attrs:{id:"data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data"}},[t._v("#")]),t._v(" data")]),t._v(" "),a("p",[t._v("要显示到页面上的才放到data中，不显示的在外面定义变量")]),t._v(" "),a("p",[t._v("取法")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("this.data.xx\n")])])]),a("p",[t._v("设置")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("this.setData({\n\txx: xx\n})\n\nthis.setData({\n        loginShow: false,\n      }, () => {\n        this.setData({\n          modalShow: true,\n        })\n      })\n")])])]),a("p",[t._v("不能频繁setData，会触发页面重绘")]),t._v(" "),a("h2",{attrs:{id:"引入async-await"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引入async-await"}},[t._v("#")]),t._v(" 引入async await")]),t._v(" "),a("p",[t._v("runtime.js 见代码")]),t._v(" "),a("h2",{attrs:{id:"调取云函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调取云函数"}},[t._v("#")]),t._v(" 调取云函数")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wx.cloud.callFunction({\n      name: 'music',\n      data: {\n        $url: 'playlist',\n        start: this.data.playlist.length,\n        count: MAX_LIMIT\n      }\n    }).then(res => {\n      console.log(res)\n      this.setData({\n        playlist: this.data.playlist.concat(res.result.data)\n      })\n      wx.stopPullDownRefresh()\n      wx.hideLoading()\n    })\n")])])]),a("p",[t._v("$url 引入了tcb-router时 对应的router")]),t._v(" "),a("h2",{attrs:{id:"限制一次100条"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#限制一次100条"}},[t._v("#")]),t._v(" 限制一次100条")]),t._v(" "),a("p",[t._v("先判断长度，循环取出来拼接起来")]),t._v(" "),a("h1",{attrs:{id:"云函数-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#云函数-2"}},[t._v("#")]),t._v(" 云函数")]),t._v(" "),a("h2",{attrs:{id:"最多50个-tcb-router"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最多50个-tcb-router"}},[t._v("#")]),t._v(" 最多50个 tcb-router")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm i tcb-router\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("// 云函数入口文件\nconst cloud = require('wx-server-sdk')\nconst TcbRouter = require('tcb-router')\ncloud.init()\n\n// 云函数入口函数\nexports.main = async (event, context) => {\n  const app = new TcbRouter({ event })\n\n  app.router('playlist', async (ctx, next) => {\n    ctx.body = await cloud.database().collection('playlist')\n      .skip(event.start)\n      .limit(event.count)\n      .orderBy('createTime', 'desc')\n      .get()\n      .then(res => {\n        return res\n      })\n  })\n\n  return app.serve()\n}\n")])])]),a("h2",{attrs:{id:"模糊搜索"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模糊搜索"}},[t._v("#")]),t._v(" 模糊搜索")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("w = {\n        content: db.RegExp({\n          regexp: keyword,\n          options: 'i'\n        })\n      }\n      \n      \n.where(w)\n")])])]),a("h2",{attrs:{id:"定时运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定时运行"}},[t._v("#")]),t._v(" 定时运行")]),t._v(" "),a("p",[t._v("config.json")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n  "triggers": [\n    {\n      "name": "myTrigger",\n      "type": "timer",\n      "config": "0 0 10,14,16,23 * * * *"\n    }\n  ]\n}\n')])])]),a("h2",{attrs:{id:"ajax请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ajax请求"}},[t._v("#")]),t._v(" ajax请求")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm i request request-promise\n\nconst rp = require('request-promise')\nrp(url)\n")])])]),a("h2",{attrs:{id:"生成小程序码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成小程序码"}},[t._v("#")]),t._v(" 生成小程序码")]),t._v(" "),a("p",[t._v("云函数")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n  "permissions": {\n    "openapi": [\n      "wxacode.getUnlimited"\n    ]\n  }\n}\n')])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const wxContext = cloud.getWXContext()\n  const result = await cloud.openapi.wxacode.getUnlimited({\n    scene: wxContext.OPENID\n    // lineColor: {\n    //   'r': 211,\n    //   'g': 60,\n    //   'b': 57\n    // },\n    // isHyaline: true\n  })\n  const upload = await cloud.uploadFile({\n    cloudPath: 'qrcode/' + Date.now() + '-' + Math.random() + '.png',\n    fileContent: result.buffer\n  })\n  return upload.fileID\n")])])]),a("h1",{attrs:{id:"后台系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后台系统"}},[t._v("#")]),t._v(" 后台系统")]),t._v(" "),a("p",[t._v("前后端分离")]),t._v(" "),a("h2",{attrs:{id:"前端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端"}},[t._v("#")]),t._v(" 前端")]),t._v(" "),a("p",[t._v("使用vue ,vue-admin-template搭建")]),t._v(" "),a("p",[t._v("改下路由、view下新增自己的页面就可以使用了")]),t._v(" "),a("h3",{attrs:{id:"滑动加载更多"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#滑动加载更多"}},[t._v("#")]),t._v(" 滑动加载更多")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const scroll = {\n    isEnd: false,\n    start(callback) {\n        let timer = null\n        callback && window.addEventListener('scroll', () => {\n            if (timer) {\n                clearTimeout(timer)\n            }\n            // 函数防抖\n            timer = setTimeout(() => {\n                // 浏览器向上滚动的高度\n                const scrollTop = document.documentElement.scrollTop || document.body.scrollTop\n                // 文档的真实高度\n                const scrollHeight = document.documentElement.scrollHeight\n                // 浏览器窗口（文档）的可视高度,就是肉眼可见的那部分全屏高度\n                const clientHeight = document.documentElement.clientHeight\n                if (!this.isEnd && scrollHeight == scrollTop + clientHeight) {\n                    window.scrollTo(0, scrollTop - 100)\n                    // 请求数据\n                    callback()\n                }\n            }, 300)\n        })\n    },\n    end() {\n        this.isEnd = true\n    }\n}\n\nexport default scroll\n\n\n")])])]),a("h3",{attrs:{id:"api放统一文件夹中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api放统一文件夹中"}},[t._v("#")]),t._v(" api放统一文件夹中")]),t._v(" "),a("p",[t._v("举个例子")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("import request from '@/utils/request'\nconst baseUrl = 'http://localhost:3000'\n\nexport function fetchList (params) {\n    return request({\n        url: `${baseUrl}/blog/list`,\n        method: 'get',\n        params\n    })\n}\n\nexport function del (params) {\n    return request({\n        url: `${baseUrl}/blog/del`,\n        method: 'post',\n        data: {\n            ...params\n        }\n    })\n}\n")])])]),a("h2",{attrs:{id:"后端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后端"}},[t._v("#")]),t._v(" 后端")]),t._v(" "),a("h3",{attrs:{id:"获取token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取token"}},[t._v("#")]),t._v(" 获取token")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const rp = require('request-promise')\nconst APPID = 'xx'\nconst APPSECRET = 'xx'\nconst URL = `https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=${APPID}&secret=${APPSECRET}`\n\nconst fs = require('fs')\nconst path = require('path')\nconst fileName = path.resolve(__dirname, './access_token.json')\nconst updateAccessToken = async () => {\n    const resStr = await rp(URL)\n    const res = JSON.parse(resStr)\n    // console.log(res)\n    if(res.access_token) {\n        fs.writeFileSync(fileName, JSON.stringify({\n            access_token: res.access_token,\n            createTime: new Date()\n        }))\n    } else {\n        await updateAccessToken()\n    }\n}\n\nconst getAccessToken = async () => {\n    try {\n        const readRes = fs.readFileSync(fileName, 'utf8')\n        const readObj = JSON.parse(readRes)\n\n        const createTime = new Date(readObj.createTime).getTime()\n        const now = new Date().getTime()\n        if ((now - createTime) / 1000 / 60 / 60 >= 2) {\n            await updateAccessToken()\n            await getAccessToken()\n        }\n        return readObj.access_token\n    } catch (error) {\n        await updateAccessToken()\n        await getAccessToken()\n    }\n}\n\nsetInterval(async () => {\n    await updateAccessToken()\n}, (7200 - 300) * 1000)\n\nmodule.exports = getAccessToken\n")])])]),a("h3",{attrs:{id:"调用云数据库、"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调用云数据库、"}},[t._v("#")]),t._v(" 调用云数据库、")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const getAccessToeken = require('../utils/getAccessToken')\nconst rp = require('request-promise')\n\nconst callCloudDB = async (ctx, fnName, query = {}) => {\n    const access_token = await getAccessToeken()\n    const url = `https://api.weixin.qq.com/tcb/${fnName}?access_token=${access_token}`\n\n    const options = {\n        method: 'POST',\n        uri: url,\n        body: {\n            query,\n            env: ctx.state.env\n        },\n        json: true // Automatically stringifies the body to JSON\n    };\n    \n    return await rp(options)\n        .then((res) => {\n            return res\n        })\n        .catch(function (err) {\n            // POST failed...\n        });\n}\n\nmodule.exports = callCloudDB\n")])])]),a("h3",{attrs:{id:"调用云函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调用云函数"}},[t._v("#")]),t._v(" 调用云函数")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const getAccessToeken = require('../utils/getAccessToken')\nconst rp = require('request-promise')\n\n\nconst callCloudFn = async (ctx, fnName, params) => {\n    const access_token = await getAccessToeken()\n    const url = `https://api.weixin.qq.com/tcb/invokecloudfunction?access_token=${access_token}&env=${ctx.state.env}&name=${fnName}`\n\n    const options = {\n        method: 'POST',\n        uri: url,\n        body: params,\n        json: true // Automatically stringifies the body to JSON\n    };\n    \n    return await rp(options)\n        .then((res) => {\n            return res\n        })\n        .catch(function (err) {\n            // POST failed...\n        });\n}\n\nmodule.exports = callCloudFn\n")])])]),a("h3",{attrs:{id:"调用云存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调用云存储"}},[t._v("#")]),t._v(" 调用云存储")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const getAccessToeken = require('../utils/getAccessToken')\nconst rp = require('request-promise')\n\nconst callCloudDB = async (ctx, fnName, query = {}) => {\n    const access_token = await getAccessToeken()\n    const url = `https://api.weixin.qq.com/tcb/${fnName}?access_token=${access_token}`\n\n    const options = {\n        method: 'POST',\n        uri: url,\n        body: {\n            ...query,\n            env: ctx.state.env\n        },\n        json: true // Automatically stringifies the body to JSON\n    };\n    \n    return await rp(options)\n        .then((res) => {\n            return res\n        })\n        .catch(function (err) {\n            // POST failed...\n        });\n}\n\nmodule.exports = callCloudDB\n")])])]),a("h3",{attrs:{id:"业务逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#业务逻辑"}},[t._v("#")]),t._v(" 业务逻辑")]),t._v(" "),a("p",[t._v("举个例子")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const Router = require('koa-router')\nconst router = new Router()\nconst callCloudDB = require('../utils/callCloudDB')\nconst callCloudStorage = require('../utils/callCloudStorage')\nconst fs = require('fs')\nconst rp = require('request-promise')\n\nrouter.get('/list', async (ctx, next) => {    \n    const params = ctx.request.query\n    const query = `db.collection('blog').skip(${params.start}).limit(${params.count}).orderBy('createTime', 'desc').get()`\n    const res = await callCloudDB(ctx, 'databasequery', query)\n    // console.log(res)\n    ctx.body = {\n        data: res.data,\n        code: 20000\n    }\n})\n\nrouter.post('/del', async (ctx, next) => {    \n    const params = ctx.request.body\n    console.log(params)\n    // 删数据库\n    const query = `db.collection('blog').doc('${params._id}').remove()`\n    const res = await callCloudDB(ctx, 'databasedelete', query)\n    // 删评论\n    const commentQuery = `db.collection('blog-comment').where({\n        blogId: '${params._id}'\n    }).remove()`\n    const commentRes = await callCloudDB(ctx, 'databasedelete', commentQuery)\n    // 删相片\n    let fileResult = {}\n    if (params.img && params.img.length > 0) {\n        fileResult = await callCloudStorage(ctx, 'batchdeletefile', {\n            fileid_list: [params.img]\n        })\n    }\n    ctx.body = {\n        data: {\n            res,\n            commentRes,\n            fileResult\n        },\n        code: 20000\n    }\n})\n\nmodule.exports = router\n")])])]),a("h3",{attrs:{id:"跨域问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域问题"}},[t._v("#")]),t._v(" 跨域问题")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm i koa2-cors\n\nconst cors = require('koa2-cors')\n\napp.use(cors({\n    origin: ['http://localhost:9528'],\n    credentials: true\n}))\n")])])]),a("h3",{attrs:{id:"post请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#post请求"}},[t._v("#")]),t._v(" post请求")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm i koa-body\n\nconst koaBody = require('koa-body')\n\napp.use(koaBody({\n    multipart: true\n}))\n")])])]),a("h3",{attrs:{id:"中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#中间件"}},[t._v("#")]),t._v(" 中间件")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("app.use(async (ctx, next) => {\n    console.log('全局中间件')\n    ctx.state.env = ENV\n    await next()\n})\n")])])]),a("h3",{attrs:{id:"路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由"}},[t._v("#")]),t._v(" 路由")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm i kia-router\n\nconst Router = require('koa-router')\nconst router = new Router()\n\nconst playlist = require('./controller/playlist')\nconst swiper = require('./controller/swiper')\nconst blog = require('./controller/blog')\nrouter.use('/playlist', playlist.routes())\nrouter.use('/swiper', swiper.routes())\nrouter.use('/blog', blog.routes())\n\napp.use(router.routes())\napp.use(router.allowedMethods())\n")])])])])}),[],!1,null,null,null);e.default=s.exports}}]);