(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{489:function(t,a,s){"use strict";s.r(a);var v=s(38),_=Object(v.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"基于x6-js封装流程图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于x6-js封装流程图"}},[t._v("#")]),t._v(" 基于"),a("code",[t._v("X6.js")]),t._v("封装流程图")]),t._v(" "),a("h2",{attrs:{id:"需求分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需求分析"}},[t._v("#")]),t._v(" 需求分析")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("支持自定义节点、边（支持通过前端框架进行自定义）")])]),t._v(" "),a("li",[a("p",[t._v("支持配置边的折线")])]),t._v(" "),a("li",[a("p",[t._v("支持布局算法")])]),t._v(" "),a("li",[a("p",[t._v("支持通过滚动条拖动画布")])]),t._v(" "),a("li",[a("p",[t._v("事件系统")])]),t._v(" "),a("li",[a("p",[t._v("缩放、导出等")])]),t._v(" "),a("li",[a("p",[t._v("支持"),a("code",[t._v("Echarts")]),t._v("渲染图表")])])]),t._v(" "),a("h2",{attrs:{id:"插件选型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件选型"}},[t._v("#")]),t._v(" 插件选型")]),t._v(" "),a("h3",{attrs:{id:"g6-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#g6-js"}},[t._v("#")]),t._v(" G6.js")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://g6.antv.antgroup.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1)]),t._v(" "),a("h4",{attrs:{id:"优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[t._v("#")]),t._v(" 优点")]),t._v(" "),a("p",[t._v("丰富的插件系统及自定义效果，支持自动布局。")]),t._v(" "),a("h4",{attrs:{id:"缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[t._v("#")]),t._v(" 缺点")]),t._v(" "),a("p",[t._v("该插件定位更趋向于数据的展示，在流程图这个方向上不够专业。")]),t._v(" "),a("p",[t._v("且不支持通过前端框架自定义节点，只支持通过"),a("code",[t._v("G2.js")]),t._v("渲染图表。")]),t._v(" "),a("h3",{attrs:{id:"logicflow"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logicflow"}},[t._v("#")]),t._v(" logicFlow")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://logic-flow.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("相比之下该插件功能就比较单薄。")]),t._v(" "),a("p",[t._v("不支持自动布局")]),t._v(" "),a("p",[t._v("不支持框架渲染")]),t._v(" "),a("p",[t._v("自带插件少")]),t._v(" "),a("h3",{attrs:{id:"x6-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x6-js"}},[t._v("#")]),t._v(" x6.js")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://x6.antv.antgroup.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1)]),t._v(" "),a("h4",{attrs:{id:"优点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优点-2"}},[t._v("#")]),t._v(" 优点")]),t._v(" "),a("p",[t._v("专门做流程图的，有很多专业的功能。")]),t._v(" "),a("p",[t._v("丰富的插件系统")]),t._v(" "),a("p",[t._v("支持通过前端框架进行渲染")]),t._v(" "),a("p",[t._v("支持使用"),a("code",[t._v("Echarts")]),t._v("渲染图表")]),t._v(" "),a("p",[t._v("性能测试1000+节点无卡顿")]),t._v(" "),a("h4",{attrs:{id:"缺点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点-2"}},[t._v("#")]),t._v(" 缺点")]),t._v(" "),a("p",[t._v("无内置布局算法，需手动实现。")]),t._v(" "),a("p",[t._v("最终决定使用"),a("code",[t._v("X6.js")]),t._v("来实现流程图。")]),t._v(" "),a("h2",{attrs:{id:"项目架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目架构"}},[t._v("#")]),t._v(" 项目架构")]),t._v(" "),a("h3",{attrs:{id:"目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[t._v("#")]),t._v(" 目录")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("└───demo // 示例\n└───docs // 文档\n└───src\n│   └───event // 事件\n│   └───hooks // 钩子函数\n│   └───layout // 布局\n│   └───method // 方法函数\n│   └───shape // 自定义元素\n│   const.ts // 常量\n│   types.ts // 类型定义\n│   useFlow.ts // 使用入口\n")])])]),a("h3",{attrs:{id:"event"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#event"}},[t._v("#")]),t._v(" event")]),t._v(" "),a("p",[t._v("由于"),a("code",[t._v("x6.js")]),t._v("已做好完善的事件系统，使用者通过：")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[t._v("graph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'event'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ngraph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("emit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'event'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("即可控制事件。")]),t._v(" "),a("p",[t._v("此处只针对"),a("code",[t._v("edge")]),t._v("的hover效果进行了处理。")]),t._v(" "),a("h3",{attrs:{id:"hooks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hooks"}},[t._v("#")]),t._v(" hooks")]),t._v(" "),a("p",[t._v("初始化流程图的主要地方：")]),t._v(" "),a("p",[t._v("配置初始化、")]),t._v(" "),a("p",[t._v("数据初始化、")]),t._v(" "),a("p",[t._v("布局、")]),t._v(" "),a("p",[t._v("混入方法、")]),t._v(" "),a("p",[t._v("模拟数据、")]),t._v(" "),a("p",[t._v("使用插件")]),t._v(" "),a("p",[t._v("等等功能。")]),t._v(" "),a("h3",{attrs:{id:"layout"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#layout"}},[t._v("#")]),t._v(" layout")]),t._v(" "),a("p",[t._v("由于"),a("code",[t._v("x6.js")]),t._v("无内置布局算法，所以这里自己封装了一套。")]),t._v(" "),a("p",[t._v("目前默认使用"),a("code",[t._v("dagre")]),t._v("算法进行布局，用户可配置其属性，已有布局位置时可手动关闭自动布局。")]),t._v(" "),a("h3",{attrs:{id:"method"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#method"}},[t._v("#")]),t._v(" method")]),t._v(" "),a("p",[t._v("对"),a("code",[t._v("graph")]),t._v("方法的补充")]),t._v(" "),a("p",[t._v("挂在其实例上，可直接调用。")]),t._v(" "),a("h3",{attrs:{id:"shape"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shape"}},[t._v("#")]),t._v(" shape")]),t._v(" "),a("p",[t._v("已内置了部分节点、边、label")]),t._v(" "),a("p",[t._v("支持使用者在外部自定义。")]),t._v(" "),a("h3",{attrs:{id:"mock"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mock"}},[t._v("#")]),t._v(" mock")]),t._v(" "),a("p",[t._v("为了测试性能，支持了模拟数据功能 。")]),t._v(" "),a("p",[t._v("可手动配置数量及层级去模拟出想要的数据。")]),t._v(" "),a("h2",{attrs:{id:"技术难点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#技术难点"}},[t._v("#")]),t._v(" 技术难点")]),t._v(" "),a("h3",{attrs:{id:"布局算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#布局算法"}},[t._v("#")]),t._v(" 布局算法")]),t._v(" "),a("p",[t._v("如果有多个分支且数量不对等时，"),a("code",[t._v("dagre")]),t._v("算法会靠下对齐，不符合设计。")]),t._v(" "),a("p",[t._v("这里通过查找出分支中x最小的坐标，进行手动对齐。")]),t._v(" "),a("h3",{attrs:{id:"交叉连线"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#交叉连线"}},[t._v("#")]),t._v(" 交叉连线")]),t._v(" "),a("p",[t._v("单个节点存在多连线、跨级连线的场景时，默认的线的路由的走向不理想。")]),t._v(" "),a("p",[t._v("这里手动计算出线的转折点，进行渲染。")]),t._v(" "),a("h3",{attrs:{id:"label位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#label位置"}},[t._v("#")]),t._v(" label位置")]),t._v(" "),a("p",[a("code",[t._v("x6.js")]),t._v("对label的位置只支持配置百分比及绝对位置，无法根据节点类型进行区分。")]),t._v(" "),a("p",[t._v("这里通过分析节点类型，自动更换边类型，达到控制label位置的需求。")]),t._v(" "),a("h3",{attrs:{id:"label渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#label渲染"}},[t._v("#")]),t._v(" label渲染")]),t._v(" "),a("p",[t._v("官方文档只给出了"),a("code",[t._v("react.js")]),t._v("的案例，分析案例，发现原理是通过svg先渲染出容器，然后通过"),a("code",[t._v("react")]),t._v("去挂载自定义内容到该容器中。")]),t._v(" "),a("p",[t._v("这种效果通过"),a("code",[t._v("vue")]),t._v("也能实现。")]),t._v(" "),a("p",[t._v("在默认配置中增加"),a("code",[t._v("onEdgeLabelRendered")]),t._v("方法，在渲染出容器后，通过"),a("code",[t._v("vue")]),t._v("的"),a("code",[t._v("h")]),t._v("、"),a("code",[t._v("render")]),t._v("函数实现将"),a("code",[t._v("vue")]),t._v("组件挂载到容器上。")]),t._v(" "),a("h3",{attrs:{id:"点击事件透传"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#点击事件透传"}},[t._v("#")]),t._v(" 点击事件透传")]),t._v(" "),a("p",[t._v("由于"),a("code",[t._v("X6")]),t._v("在"),a("code",[t._v("node_modules\\@antv\\x6\\src\\graph\\view.ts")]),t._v("中直接监听了各种事件，导致在vue自定义节点中，会同时触发收起和点击两个事件。")]),t._v(" "),a("p",[t._v("通过查阅源码，发现有暴露"),a("code",[t._v("guard")]),t._v("函数来控制事件冒泡。")]),t._v(" "),a("p",[t._v("通过在初始化Graph时传入"),a("code",[t._v("guard")]),t._v("函数，迭代判断父节点的类名是否包含指定的需要停止冒泡的类名，从而解决同时触发点击事件的效果。")]),t._v(" "),a("h3",{attrs:{id:"tooltip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tooltip"}},[t._v("#")]),t._v(" tooltip")]),t._v(" "),a("p",[t._v("X6官网的tooltip案例使用起来十分不方便，这里做成了配置化")]),t._v(" "),a("p",[t._v("只需要在数据上配置即可显示出tooltip")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[t._v("tools"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tooltip'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    args"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      tooltip"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Tooltip Content'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      component"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Tooltip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),a("h3",{attrs:{id:"画布尺寸"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#画布尺寸"}},[t._v("#")]),t._v(" 画布尺寸")]),t._v(" "),a("p",[t._v("X6的画布大小是会自动撑开，留出大量的空白区域供拖动，这样的效果不符合使用场景。")]),t._v(" "),a("p",[t._v("这里通过获取内容的实际大小，强制修改画布的大小，达到无空白区域的效果。")])])}),[],!1,null,null,null);a.default=_.exports}}]);