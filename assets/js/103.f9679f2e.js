(window.webpackJsonp=window.webpackJsonp||[]).push([[103],{512:function(a,t,v){"use strict";v.r(t);var s=v(38),_=Object(s.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"拓扑图虚拟渲染"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拓扑图虚拟渲染"}},[a._v("#")]),a._v(" 拓扑图虚拟渲染")]),a._v(" "),t("h2",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[a._v("#")]),a._v(" 背景")]),a._v(" "),t("p",[a._v("原拓扑图中，在几千个设备时，浏览器就会很卡顿，操作通常需要几秒钟才有反应，体验十分差。")]),a._v(" "),t("p",[a._v("当时也做了相关的性能优化，比如开启g6的"),t("code",[a._v("enableOptimize")]),a._v("，这会在拖动和缩放时，只显示图形的keyShape，这样可以减少同时操作的图元的元素，但在几千数量的时候，一样会卡顿。")]),a._v(" "),t("p",[a._v("那么还有什么好办法吗？借鉴表格的虚拟列表来的灵感，能不能只渲染可视范围中的图形呢？")]),a._v(" "),t("h2",{attrs:{id:"实现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[a._v("#")]),a._v(" 实现")]),a._v(" "),t("h3",{attrs:{id:"监听事件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监听事件"}},[a._v("#")]),a._v(" 监听事件")]),a._v(" "),t("p",[a._v("首先，我们需要监听滚动和缩放事件，之前已经写过了"),t("code",[a._v("graph-zoom")]),a._v("、"),t("code",[a._v("drag-canvas-select")]),a._v("，在这两个行为中，有去监听事件，我们判断当设备数量大于200时再开启虚拟渲染（数量少时不需要）。")]),a._v(" "),t("p",[a._v("示例：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("'canvas:dragstart': 'onDragstart'\n[CUSTOM_EVENT.zoom]: 'debounceOnZoom'\n")])])]),t("p",[a._v("当然，为了减少重复操作，我们需要做一个节流，这里设置200ms。")]),a._v(" "),t("h3",{attrs:{id:"处理数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#处理数据"}},[a._v("#")]),a._v(" 处理数据")]),a._v(" "),t("p",[a._v("事件触发后，收集所有的node和edge，通过自身的包围盒坐标与视口坐标判断是否在可视范围内，如果存在则渲染出来，否则隐藏掉。")]),a._v(" "),t("p",[a._v("当然，为了显示效果的流畅，视口这个范围不是用的真实的，而是加了500尺寸的缓冲区，避免拖的过程中出现空白。")]),a._v(" "),t("p",[a._v("需要注意的是，之前动态计算坐标是获取所有未隐藏的节点去计算，现在虚拟渲染给隐藏了，就需要特殊处理一下，判断是虚拟渲染给隐藏的也要参数坐标的计算。")]),a._v(" "),t("p",[a._v("另外存在收起的节点，这种需要判断父节点的展开收起状态，如果是收起的则可以不处理。")]),a._v(" "),t("h3",{attrs:{id:"效果对比"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#效果对比"}},[a._v("#")]),a._v(" 效果对比")]),a._v(" "),t("p",[a._v("测试4000台设备：")]),a._v(" "),t("p",[a._v("优化前，基本只能15~30帧，操作能明显感到卡顿，基本会延迟1s")]),a._v(" "),t("p",[a._v("优化后，基本在50帧以上，操作与数量少时几乎感觉不出差异。")]),a._v(" "),t("p",[a._v("由于优化后只渲染了可视部分，所以且当数量越大时，效果越明显。")]),a._v(" "),t("p",[a._v("并且在显示上，只显示keyShape会让人感到疑惑，而虚拟渲染则是显示全部图形，效果也更好。")])])}),[],!1,null,null,null);t.default=_.exports}}]);