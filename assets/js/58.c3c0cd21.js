(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{480:function(s,a,t){"use strict";t.r(a);var n=t(70),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"控制器自动打包拓扑图项目代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#控制器自动打包拓扑图项目代码"}},[s._v("#")]),s._v(" 控制器自动打包拓扑图项目代码")]),s._v(" "),t("h2",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),t("p",[s._v("目前拓扑图是个独立的项目，每次更改代码后需要打包->复制文件去控制器项目。")]),s._v(" "),t("p",[s._v("频繁地修改代码下这种方式是不可取的，于是在控制器的打包脚本中，增加将拓扑图打包到指定路径的逻辑，解决这种问题。")]),s._v(" "),t("h2",{attrs:{id:"实现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[s._v("#")]),s._v(" 实现")]),s._v(" "),t("h3",{attrs:{id:"拉取拓扑图项目代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拉取拓扑图项目代码"}},[s._v("#")]),s._v(" 拉取拓扑图项目代码")]),s._v(" "),t("p",[s._v("公司项目使用的"),t("code",[s._v("gitlab")]),s._v("，而"),t("code",[s._v("gitlab")]),s._v("拉取代码一般都通过生成个设备的秘钥，但是我们打包服务器通常不是固定的一台，所以通过注册一个个人"),t("code",[s._v("token")]),s._v("去拉取代码。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone http://oauth2:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("你的token"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("@code.sangfor.org/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("repo_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(".git\n")])])]),t("h3",{attrs:{id:"拉取node-js"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拉取node-js"}},[s._v("#")]),s._v(" 拉取node.js")]),s._v(" "),t("p",[s._v("因为公司是内网环境，不能直接拉取公网的node.js包，所以将node包下载好后放在svn服务器上（旧有逻辑），打包时拉取下来")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("svn "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" svn://path --force --username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" --password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" --force  --no-auth-cache\n")])])]),t("p",[s._v("拉下来后解压")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">> tar -xvf..."')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xvf ./node-v16.15.0-linux-x64.tar.xz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf ./node-v16.15.0-linux-x64.tar.xz\n")])])]),t("p",[s._v("修改权限")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">> chmod node"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x ./node-v16.15.0-linux-x64/bin/*\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(" -ne "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chmod node error!"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])])]),t("p",[s._v("添加临时环境变量（重点）")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v("/node-v16.15.0-linux-x64/bin\n")])])]),t("p",[s._v("因为不需要安装node到环境中，所以这里添加node到临时环境变量中，只在本线程中生效")]),s._v(" "),t("h3",{attrs:{id:"安装项目依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装项目依赖"}},[s._v("#")]),s._v(" 安装项目依赖")]),s._v(" "),t("p",[s._v("因为公司内网搭建了自己的npm服务器，所以这里先要切换下npm服务器路径再进行安装")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">> npm registry"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" config "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" registry http://path\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">> npm install..."')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">> npm run build..."')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build\n")])])]),t("h3",{attrs:{id:"复制打包文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#复制打包文件"}},[s._v("#")]),s._v(" 复制打包文件")]),s._v(" "),t("p",[s._v("打包好后复制文件到所需文件夹路径即可")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">> copy dist"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r UED-Graph/dist/* ./WLAN/js/components/vendor/topo\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">> delete UED-Graph"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf ./UED-Graph\n")])])]),t("h2",{attrs:{id:"遇到的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题"}},[s._v("#")]),s._v(" 遇到的问题")]),s._v(" "),t("h3",{attrs:{id:"shell文件格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shell文件格式"}},[s._v("#")]),s._v(" shell文件格式")]),s._v(" "),t("p",[s._v("因为是在windows下进行的编写，所以传到linux后运行时会报格式问题")]),s._v(" "),t("p",[s._v("进vim修改下格式即可。")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v(":set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fileformat")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unix\n:wq\n")])])]),t("h3",{attrs:{id:"报错glibc-2-16-not-found"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#报错glibc-2-16-not-found"}},[s._v("#")]),s._v(" 报错GLIBC_2.16 not found")]),s._v(" "),t("p",[s._v("这是因为Jenkins环境老旧")]),s._v(" "),t("p",[s._v("打包流水线不止是打包前端代码，还有硬件那边的代码，环境依赖不敢随便升级")]),s._v(" "),t("p",[s._v("这联系后台人员去处理了")])])}),[],!1,null,null,null);a.default=e.exports}}]);