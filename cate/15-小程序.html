<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微信小程序云开发 | Lawz&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/vuepress-blog/logo.jpg">
    <meta name="description" content="罗政的个人博客">
    
    <link rel="preload" href="/vuepress-blog/assets/css/0.styles.a53365af.css" as="style"><link rel="preload" href="/vuepress-blog/assets/js/app.d2e1425f.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/2.52cbf88a.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/86.a2a0c8d1.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/js/10.45ae65b9.js"><link rel="prefetch" href="/vuepress-blog/assets/js/100.143f1bc7.js"><link rel="prefetch" href="/vuepress-blog/assets/js/101.2980f849.js"><link rel="prefetch" href="/vuepress-blog/assets/js/11.6c681e4f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/12.e05150ed.js"><link rel="prefetch" href="/vuepress-blog/assets/js/13.86df7c7c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/14.57923247.js"><link rel="prefetch" href="/vuepress-blog/assets/js/15.35e21e35.js"><link rel="prefetch" href="/vuepress-blog/assets/js/16.c53bf93c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/17.5281dcd6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/18.a460ba23.js"><link rel="prefetch" href="/vuepress-blog/assets/js/19.d7995de0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/20.ca632186.js"><link rel="prefetch" href="/vuepress-blog/assets/js/21.86571bbc.js"><link rel="prefetch" href="/vuepress-blog/assets/js/22.e7dd2c67.js"><link rel="prefetch" href="/vuepress-blog/assets/js/23.5fd56a4d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/24.decc4e21.js"><link rel="prefetch" href="/vuepress-blog/assets/js/25.f3bf686a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/26.35e25ac6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/27.a2a809b5.js"><link rel="prefetch" href="/vuepress-blog/assets/js/28.cf26283c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/29.c0bb7f61.js"><link rel="prefetch" href="/vuepress-blog/assets/js/3.a1060374.js"><link rel="prefetch" href="/vuepress-blog/assets/js/30.e9b4bf42.js"><link rel="prefetch" href="/vuepress-blog/assets/js/31.6a9fb1ef.js"><link rel="prefetch" href="/vuepress-blog/assets/js/32.96fc20cd.js"><link rel="prefetch" href="/vuepress-blog/assets/js/33.544b532a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/34.eeae8358.js"><link rel="prefetch" href="/vuepress-blog/assets/js/35.eb6f1a52.js"><link rel="prefetch" href="/vuepress-blog/assets/js/36.07912d58.js"><link rel="prefetch" href="/vuepress-blog/assets/js/37.47575c3f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/38.480ffe04.js"><link rel="prefetch" href="/vuepress-blog/assets/js/39.eb306d98.js"><link rel="prefetch" href="/vuepress-blog/assets/js/4.cf0ba728.js"><link rel="prefetch" href="/vuepress-blog/assets/js/40.ce6dcbc4.js"><link rel="prefetch" href="/vuepress-blog/assets/js/41.89e9a0b6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/42.2fbf956e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/43.1f085205.js"><link rel="prefetch" href="/vuepress-blog/assets/js/44.95e2ae8f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/45.e42c2499.js"><link rel="prefetch" href="/vuepress-blog/assets/js/46.711c83b5.js"><link rel="prefetch" href="/vuepress-blog/assets/js/47.116d350e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/48.a5313e5b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/49.518304d0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/5.31059d95.js"><link rel="prefetch" href="/vuepress-blog/assets/js/50.7bdeb318.js"><link rel="prefetch" href="/vuepress-blog/assets/js/51.e9e9436c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/52.a08071fa.js"><link rel="prefetch" href="/vuepress-blog/assets/js/53.dca6b71e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/54.1faead91.js"><link rel="prefetch" href="/vuepress-blog/assets/js/55.70aabea8.js"><link rel="prefetch" href="/vuepress-blog/assets/js/56.db84625a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/57.5ab1005a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/58.aad22819.js"><link rel="prefetch" href="/vuepress-blog/assets/js/59.743800e1.js"><link rel="prefetch" href="/vuepress-blog/assets/js/6.21a47d84.js"><link rel="prefetch" href="/vuepress-blog/assets/js/60.53d5185f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/61.b1ef5e9e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/62.434b0130.js"><link rel="prefetch" href="/vuepress-blog/assets/js/63.91c67f65.js"><link rel="prefetch" href="/vuepress-blog/assets/js/64.34e518e4.js"><link rel="prefetch" href="/vuepress-blog/assets/js/65.24b4450e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/66.2d3f86f5.js"><link rel="prefetch" href="/vuepress-blog/assets/js/67.ea8068f9.js"><link rel="prefetch" href="/vuepress-blog/assets/js/68.3f0ff6ea.js"><link rel="prefetch" href="/vuepress-blog/assets/js/69.1b78eb6b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/7.58c9b76c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/70.43f65c6c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/71.64b34631.js"><link rel="prefetch" href="/vuepress-blog/assets/js/72.b17edce0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/73.d1730f20.js"><link rel="prefetch" href="/vuepress-blog/assets/js/74.63ee6d0b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/75.b3966f12.js"><link rel="prefetch" href="/vuepress-blog/assets/js/76.977cbbfe.js"><link rel="prefetch" href="/vuepress-blog/assets/js/77.586a53e7.js"><link rel="prefetch" href="/vuepress-blog/assets/js/78.aeccd7ed.js"><link rel="prefetch" href="/vuepress-blog/assets/js/79.ad2b30ac.js"><link rel="prefetch" href="/vuepress-blog/assets/js/8.2c655620.js"><link rel="prefetch" href="/vuepress-blog/assets/js/80.8e8d7699.js"><link rel="prefetch" href="/vuepress-blog/assets/js/81.ce5de9d6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/82.2de0dbfa.js"><link rel="prefetch" href="/vuepress-blog/assets/js/83.480815a1.js"><link rel="prefetch" href="/vuepress-blog/assets/js/84.cd0584af.js"><link rel="prefetch" href="/vuepress-blog/assets/js/85.341909ca.js"><link rel="prefetch" href="/vuepress-blog/assets/js/87.b09f7326.js"><link rel="prefetch" href="/vuepress-blog/assets/js/88.84a30856.js"><link rel="prefetch" href="/vuepress-blog/assets/js/89.e344df4e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/9.e41b2676.js"><link rel="prefetch" href="/vuepress-blog/assets/js/90.6377e3e2.js"><link rel="prefetch" href="/vuepress-blog/assets/js/91.077d95e9.js"><link rel="prefetch" href="/vuepress-blog/assets/js/92.e78128f3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/93.e73e9f50.js"><link rel="prefetch" href="/vuepress-blog/assets/js/94.cc6d88ae.js"><link rel="prefetch" href="/vuepress-blog/assets/js/95.65c97d1d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/96.988aa4bd.js"><link rel="prefetch" href="/vuepress-blog/assets/js/97.2faa96b8.js"><link rel="prefetch" href="/vuepress-blog/assets/js/98.1cdec98c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/99.47766256.js">
    <link rel="stylesheet" href="/vuepress-blog/assets/css/0.styles.a53365af.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-blog/" class="home-link router-link-active"><!----> <span class="site-name">Lawz's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-blog/blog/2023-01-06 新手指引的封装.html" class="nav-link">
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识分类" class="dropdown-title"><span class="title">知识分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="知识分类" class="mobile-dropdown-title"><span class="title">知识分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/01-Html.html" class="nav-link">
  Html
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/02-Css.html" class="nav-link">
  Css
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/03-Js.html" class="nav-link">
  Js
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/04-Browser.html" class="nav-link">
  Browser
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/05-Vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/06-React.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/07-Node.html" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/08-RegEx.html" class="nav-link">
  RegEx
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/09-IDE.html" class="nav-link">
  IDE
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/10-算法.html" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/11-Git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/12-Nginx.html" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/13-Typescript.html" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/14-webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/15-小程序.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/16-Hybird.html" class="nav-link">
  Hybird
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/17-安全.html" class="nav-link">
  安全
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/18-面试.html" class="nav-link">
  面试
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/19-网络.html" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/20-知识回顾.html" class="nav-link">
  知识回顾
</a></li></ul></div></div><div class="nav-item"><a href="/vuepress-blog/book/2021-03-28 香帅财富报告.html" class="nav-link">
  阅读
</a></div><div class="nav-item"><a href="/vuepress-blog/webArchitect/01-架构师思维.html" class="nav-link">
  web架构师
</a></div><div class="nav-item"><a href="https://github.com/lawzheng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-blog/blog/2023-01-06 新手指引的封装.html" class="nav-link">
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识分类" class="dropdown-title"><span class="title">知识分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="知识分类" class="mobile-dropdown-title"><span class="title">知识分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/01-Html.html" class="nav-link">
  Html
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/02-Css.html" class="nav-link">
  Css
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/03-Js.html" class="nav-link">
  Js
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/04-Browser.html" class="nav-link">
  Browser
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/05-Vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/06-React.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/07-Node.html" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/08-RegEx.html" class="nav-link">
  RegEx
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/09-IDE.html" class="nav-link">
  IDE
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/10-算法.html" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/11-Git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/12-Nginx.html" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/13-Typescript.html" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/14-webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/15-小程序.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/16-Hybird.html" class="nav-link">
  Hybird
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/17-安全.html" class="nav-link">
  安全
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/18-面试.html" class="nav-link">
  面试
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/19-网络.html" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/cate/20-知识回顾.html" class="nav-link">
  知识回顾
</a></li></ul></div></div><div class="nav-item"><a href="/vuepress-blog/book/2021-03-28 香帅财富报告.html" class="nav-link">
  阅读
</a></div><div class="nav-item"><a href="/vuepress-blog/webArchitect/01-架构师思维.html" class="nav-link">
  web架构师
</a></div><div class="nav-item"><a href="https://github.com/lawzheng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>微信小程序云开发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#起步" class="sidebar-link">起步</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#云开发" class="sidebar-link">云开发</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#app-json" class="sidebar-link">app.json</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#dom绑定事件" class="sidebar-link">Dom绑定事件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#禁止页面滚动" class="sidebar-link">禁止页面滚动</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#暂停动画" class="sidebar-link">暂停动画</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#获取openid并存储" class="sidebar-link">获取openid并存储</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#app-wsxx" class="sidebar-link">app.wsxx</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#轮播图" class="sidebar-link">轮播图</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#全局音乐" class="sidebar-link">全局音乐</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#获取dom元素" class="sidebar-link">获取dom元素</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#组件" class="sidebar-link">组件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#设置页面标题" class="sidebar-link">设置页面标题</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#获取用户信息" class="sidebar-link">获取用户信息</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#格式化时间" class="sidebar-link">格式化时间</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#跳转页面" class="sidebar-link">跳转页面</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#格式化播放次数" class="sidebar-link">格式化播放次数</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#高斯模糊" class="sidebar-link">高斯模糊</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#storage" class="sidebar-link">storage</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#上拉加载" class="sidebar-link">上拉加载</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#下拉刷新" class="sidebar-link">下拉刷新</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#全局组件" class="sidebar-link">全局组件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#配置分享" class="sidebar-link">配置分享</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#按钮触发" class="sidebar-link">按钮触发</a></li></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#图片" class="sidebar-link">图片</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#上传" class="sidebar-link">上传</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#预览" class="sidebar-link">预览</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#上传到云存储" class="sidebar-link">上传到云存储</a></li></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#获取上一页面" class="sidebar-link">获取上一页面</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#配置订阅消息" class="sidebar-link">配置订阅消息</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#dom" class="sidebar-link">dom</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#点击获取权限" class="sidebar-link">点击获取权限</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#云函数" class="sidebar-link">云函数</a></li></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#data" class="sidebar-link">data</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#引入async-await" class="sidebar-link">引入async await</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#调取云函数" class="sidebar-link">调取云函数</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#限制一次100条" class="sidebar-link">限制一次100条</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#最多50个-tcb-router" class="sidebar-link">最多50个 tcb-router</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#模糊搜索" class="sidebar-link">模糊搜索</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#定时运行" class="sidebar-link">定时运行</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#ajax请求" class="sidebar-link">ajax请求</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#生成小程序码" class="sidebar-link">生成小程序码</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#前端" class="sidebar-link">前端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#滑动加载更多" class="sidebar-link">滑动加载更多</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#api放统一文件夹中" class="sidebar-link">api放统一文件夹中</a></li></ul></li><li><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#后端" class="sidebar-link">后端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#获取token" class="sidebar-link">获取token</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#调用云数据库、" class="sidebar-link">调用云数据库、</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#调用云函数" class="sidebar-link">调用云函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#调用云存储" class="sidebar-link">调用云存储</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#业务逻辑" class="sidebar-link">业务逻辑</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#跨域问题" class="sidebar-link">跨域问题</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#post请求" class="sidebar-link">post请求</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#中间件" class="sidebar-link">中间件</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/cate/15-%E5%B0%8F%E7%A8%8B%E5%BA%8F.html#路由" class="sidebar-link">路由</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="微信小程序云开发"><a href="#微信小程序云开发" class="header-anchor">#</a> 微信小程序云开发</h1> <h2 id="起步"><a href="#起步" class="header-anchor">#</a> 起步</h2> <p>微信公众平台注册、下载开发者工具等</p> <h2 id="云开发"><a href="#云开发" class="header-anchor">#</a> 云开发</h2> <p>创建时勾选</p> <p>进工具 左上角点云开发 一步步开通</p> <p>重新编译</p> <p>一般要等个几分钟</p> <h2 id="app-json"><a href="#app-json" class="header-anchor">#</a> app.json</h2> <ol><li><p>page添加页面，会自动生成对应文件</p></li> <li><div class="language- extra-class"><pre class="language-text"><code>&quot;window&quot;: {
    &quot;backgroundColor&quot;: &quot;#F6F6F6&quot;,
    &quot;backgroundTextStyle&quot;: &quot;light&quot;,
    &quot;navigationBarBackgroundColor&quot;: &quot;#d43c33&quot;,
    &quot;navigationBarTitleText&quot;: &quot;音乐&quot;,
    &quot;navigationBarTextStyle&quot;: &quot;white&quot;
  },
  一看就懂 不用注释
</code></pre></div></li> <li><div class="language- extra-class"><pre class="language-text"><code>&quot;tabBar&quot;: {
    &quot;color&quot;: &quot;#474747&quot;,
    &quot;selectedColor&quot;: &quot;#d43c43&quot;,
    &quot;list&quot;: [
      {
        &quot;pagePath&quot;: &quot;pages/playlist/playlist&quot;,
        &quot;text&quot;: &quot;音乐&quot;,
        &quot;iconPath&quot;: &quot;images/music.png&quot;,
        &quot;selectedIconPath&quot;: &quot;images/music-actived.png&quot;
      },
      {
        &quot;pagePath&quot;: &quot;pages/blog/blog&quot;,
        &quot;text&quot;: &quot;发现&quot;,
        &quot;iconPath&quot;: &quot;images/blog.png&quot;,
        &quot;selectedIconPath&quot;: &quot;images/blog-actived.png&quot;
      },
      {
        &quot;pagePath&quot;: &quot;pages/profile/profile&quot;,
        &quot;text&quot;: &quot;我的&quot;,
        &quot;iconPath&quot;: &quot;images/profile.png&quot;,
        &quot;selectedIconPath&quot;: &quot;images/profile-actived.png&quot;
      }
    ]
  },
  同一看就懂
</code></pre></div></li> <li><p>全局属性</p> <div class="language- extra-class"><pre class="language-text"><code>this.globalData = {
      playingMusicId: -1,
      openid: -1
    }
</code></pre></div><p>写全局方法去get\set</p> <div class="language- extra-class"><pre class="language-text"><code>setPlayMusicId(playingMusicId) {
    this.globalData.playingMusicId = playingMusicId
  },
  getPlayMusicId() {
    return this.globalData.playingMusicId
  },
</code></pre></div><p>在页面中获取</p> <div class="language- extra-class"><pre class="language-text"><code>const app = getApp()

app.xx即可
</code></pre></div></li></ol> <h2 id="dom绑定事件"><a href="#dom绑定事件" class="header-anchor">#</a> Dom绑定事件</h2> <div class="language- extra-class"><pre class="language-text"><code>class=&quot;musiclist-container {{item.id === playingId ? 'playing': ''}}&quot; 
动态class直接跟着写

bind:tap=&quot;onSelect&quot; 
不能括号传参 要用tab事件 click有300ms延迟？猜测 没去查

传参方式 设置attribute
data-musicid=&quot;{{item.id}}&quot; 
data-index=&quot;{{index}}&quot;

在方法里获取
const musicId = event.currentTarget.dataset.musicid
const index = event.currentTarget.dataset.index
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>bind:catch 捕获
</code></pre></div><h2 id="禁止页面滚动"><a href="#禁止页面滚动" class="header-anchor">#</a> 禁止页面滚动</h2> <p>对应页面json中</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;disableScroll&quot;: true
</code></pre></div><h2 id="暂停动画"><a href="#暂停动画" class="header-anchor">#</a> 暂停动画</h2> <div class="language- extra-class"><pre class="language-text"><code>animation-play-state: paused;
</code></pre></div><h2 id="获取openid并存储"><a href="#获取openid并存储" class="header-anchor">#</a> 获取openid并存储</h2> <div class="language- extra-class"><pre class="language-text"><code>getOpenId () {
    wx.cloud.callFunction({
      name: 'login'
    }).then(res =&gt; {
      const openid = res.result.openid
      this.globalData.openid = openid
      if (wx.getStorageSync(openid) === '') {
        wx.setStorageSync(openid, [])
      }
    })
  }
  
  在app.js中调用即可
</code></pre></div><h2 id="app-wsxx"><a href="#app-wsxx" class="header-anchor">#</a> app.wsxx</h2> <p>全局样式</p> <p>引入别的样式 @import &quot;xx.wsxx&quot;</p> <h2 id="轮播图"><a href="#轮播图" class="header-anchor">#</a> 轮播图</h2> <div class="language- extra-class"><pre class="language-text"><code>&lt;swiper indicator-dots=&quot;true&quot; autoplay=&quot;true&quot; interval=&quot;2000&quot; duration=&quot;200&quot; circular=&quot;true&quot;&gt;
  &lt;block wx:for=&quot;{{swiperImgUrls}}&quot; wx:key=&quot;item.fileid&quot;&gt;
    &lt;swiper-item&gt;
      &lt;image src=&quot;{{item.fileid}}&quot; mode=&quot;widthFix&quot; class=&quot;img&quot;&gt;&lt;/image&gt;
    &lt;/swiper-item&gt;
  &lt;/block&gt;
&lt;/swiper&gt;
</code></pre></div><p>建议用block包裹</p> <p>image标签可以直接获取到云文件的图片 fileid</p> <p>wx:key里的参数不用加{{}}</p> <h2 id="全局音乐"><a href="#全局音乐" class="header-anchor">#</a> 全局音乐</h2> <ol><li><p>app.json</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;requiredBackgroundModes&quot;: [

    &quot;audio&quot;

 ],
</code></pre></div></li> <li><div class="language- extra-class"><pre class="language-text"><code>const backgroundAudioManager = wx.getBackgroundAudioManager()
</code></pre></div></li> <li><p>绑定事件</p> <div class="language- extra-class"><pre class="language-text"><code>_bindBGMEvent () {
      backgroundAudioManager.onPlay(() =&gt; {
        isMoving = false
        this.triggerEvent('musicPlay')
      })

      backgroundAudioManager.onStop(() =&gt; {
        console.log()
      })

      backgroundAudioManager.onPause(() =&gt; {
        this.triggerEvent('musicPause')
      })

      backgroundAudioManager.onWaiting(() =&gt; {
        console.log()
      })

      backgroundAudioManager.onCanplay(() =&gt; {
        if (typeof backgroundAudioManager.duration !== 'undefined') {
          this._setTime()
        } else {
          setTimeout(() =&gt; {
            this._setTime()
          }, 1000)
        }
      })

      backgroundAudioManager.onTimeUpdate(() =&gt; {
        if (!isMoving) {
          const currentTime = backgroundAudioManager.currentTime
          const currentTimeFmt = this._dateFormat(currentTime)
          const percent = currentTime / backgroundAudioManager.duration
          const sec = currentTime.toString().split('.')[0]
          if (currentSec !== sec) {
            this.setData({
              ['showTime.currentTime']: `${currentTimeFmt.min}:${currentTimeFmt.sec}`,
              movableDis: percent * (movableAreaWidth - movableViewWidth),
              progress: percent * 100
            })
            currentSec = sec
            this.triggerEvent('timeUpdate', {
              currentTime
            })
          }
        }
      })

      backgroundAudioManager.onEnded(() =&gt; {
        this.triggerEvent('musicEnd')
      })

      backgroundAudioManager.onError((res) =&gt; {
        console.log(res.errMsg)
        console.log(res.errCode)
        wx.showToast({
          title: '错误:' + res.errCode,
        })
      })
    },
</code></pre></div></li></ol> <h2 id="获取dom元素"><a href="#获取dom元素" class="header-anchor">#</a> 获取dom元素</h2> <div class="language- extra-class"><pre class="language-text"><code>	  const query = this.createSelectorQuery()
      query.select('.movable-area').boundingClientRect()
      query.select('.movable-view').boundingClientRect()
      query.exec(rect =&gt; {
        console.log(rect)
        movableAreaWidth = rect[0].width
        movableViewWidth = rect[1].width
      })
</code></pre></div><h2 id="组件"><a href="#组件" class="header-anchor">#</a> 组件</h2> <ol><li><p>在对应页面的json文件中加上</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;usingComponents&quot;: {
    &quot;x-playlist&quot;: &quot;/components/playlist/playlist&quot;
  },
</code></pre></div></li> <li><div class="language- extra-class"><pre class="language-text"><code>properties: {
    playlist: {
      type: Object
    },
    text: {
    	type: String,
    	value: ''
    }
  },
</code></pre></div><p>跟vue prop类似 注意default 改为value</p></li> <li><div class="language- extra-class"><pre class="language-text"><code>observers: {
    ['playlist.playCount'](count) {
      this.setData({
        _count: this._tranNumber(count, 2)
      })
    }
  },
 类似watch
 可以观察到对象中的属性
</code></pre></div></li> <li><p>分发事件</p> <div class="language- extra-class"><pre class="language-text"><code>this.triggerEvent('search', {
        keyword
      })
bind:musicEnd=&quot;XX&quot;
keyword = event.detail.keyword

原生事件
bindtouchend 没冒号
</code></pre></div></li> <li><p>生命周期</p> <div class="language- extra-class"><pre class="language-text"><code>lifetimes: {
    ready() { // 钩子
      wx.getSystemInfo({
        success: function(res) {
          lyricHeight = res.screenWidth / 750 * 65
        },
      })
    }
  },
</code></pre></div></li> <li><p>获取外界css</p> <div class="language- extra-class"><pre class="language-text"><code>externalClasses: [
    'iconfont',
    'icon-sousuo'
  ],
  
 组件标签上
 iconfont=&quot;iconfont&quot; icon-sousuo=&quot;icon-sousuo&quot;
</code></pre></div></li> <li><p>插槽</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;slot name=&quot;modal-content&quot;&gt;&lt;/slot&gt;

&lt;view slot=&quot;modal-content&quot;&gt;
    &lt;button class=&quot;login&quot;
      open-type=&quot;getUserInfo&quot;
      bindgetuserinfo=&quot;onGotUserInfo&quot;
    &gt;获取微信授权信息&lt;/button&gt;
  &lt;/view&gt;
</code></pre></div></li></ol> <h2 id="设置页面标题"><a href="#设置页面标题" class="header-anchor">#</a> 设置页面标题</h2> <ol><li><div class="language- extra-class"><pre class="language-text"><code>动态设置
wx.setNavigationBarTitle({
      title: music.name
    })
</code></pre></div></li> <li><div class="language- extra-class"><pre class="language-text"><code>对应json
&quot;navigationBarTitleText&quot;: &quot;正文&quot;
</code></pre></div></li></ol> <h2 id="获取用户信息"><a href="#获取用户信息" class="header-anchor">#</a> 获取用户信息</h2> <ol><li><p>open-data 页面直接显示 只能显示自己的</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;open-data type=&quot;userNickName&quot;&gt;&lt;/open-data&gt;
&lt;open-data type=&quot;userAvatarUrl&quot;&gt;&lt;/open-data&gt;
</code></pre></div></li> <li><p>wx.getUserInfo() 不支持弹出授权</p></li> <li><p>button open-type 没openid</p></li> <li><p>云开发 自带login函数</p></li></ol> <div class="language- extra-class"><pre class="language-text"><code>wx.getSetting({
      success: (res) =&gt; {
        console.log(res)
        if (res.authSetting['scope.userInfo']) {
          wx.getUserInfo({
            success: (res) =&gt; {
              console.log(res)
              this.onLoginSuccess({
                detail: res.userInfo
              })
            }
          })
        } else {
          this.setData({
            modalShow: true
          })
        }
      }
    })
</code></pre></div><p>用按钮调用</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;button class=&quot;login&quot;
      open-type=&quot;getUserInfo&quot;
      bindgetuserinfo=&quot;onGotUserInfo&quot;
    &gt;获取微信授权信息&lt;/button&gt;
</code></pre></div><h2 id="格式化时间"><a href="#格式化时间" class="header-anchor">#</a> 格式化时间</h2> <div class="language- extra-class"><pre class="language-text"><code>module.exports = (date) =&gt; {
  let fmt = 'yyyy-MM-dd hh:mm:ss'
  const o = {
    'M+': date.getMonth() + 1, // 月份
    'd+': date.getDate(), // 日
    'h+': date.getHours(), // 小时
    'm+': date.getMinutes(), // 分钟
    's+': date.getSeconds(), // 秒
  }

  if (/(y+)/.test(fmt)) {
    fmt = fmt.replace(RegExp.$1, date.getFullYear())
  }
  for (let k in o) {
    if (new RegExp('(' + k + ')').test(fmt)) {
      fmt = fmt.replace(RegExp.$1, o[k].toString().length == 1 ? '0' + o[k] : o[k])
    }
  }

  // console.log(fmt)
  return fmt
}
</code></pre></div><p>替换模板获得对应格式</p> <h2 id="跳转页面"><a href="#跳转页面" class="header-anchor">#</a> 跳转页面</h2> <ol><li>js</li></ol> <div class="language- extra-class"><pre class="language-text"><code>wx.navigateTo({
        url: `../../pages/musiclist/musiclist?playlistId=${this.properties.playlist.id}`,
})
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>wx.navigateBack({})
</code></pre></div><ol start="2"><li><p>路由</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;navigator class=&quot;content&quot; hover-class=&quot;none&quot; url=&quot;/pages/profile-playhistory/profile-playhistory&quot;&gt;
      &lt;i class=&quot;iconfont icon-ziyuanldpi&quot;&gt;&lt;/i&gt;
      &lt;text class=&quot;text&quot;&gt;最近播放&lt;/text&gt;
      &lt;i class=&quot;iconfont icon-xiangyou&quot;&gt;&lt;/i&gt;
    &lt;/navigator&gt;
</code></pre></div></li></ol> <h2 id="格式化播放次数"><a href="#格式化播放次数" class="header-anchor">#</a> 格式化播放次数</h2> <div class="language- extra-class"><pre class="language-text"><code>/**
 * point保留小数位
 */
_tranNumber(num, point) {
      let numStr = num.toString().split('.')[0]
      if (numStr.length &lt; 6) {
        return numStr
      } else if (numStr.length &gt;= 6 &amp;&amp; numStr.length &lt;=8 ) {
        let decimal = numStr.substring(numStr.length - 4, numStr.length - 4 - point)
        return parseFloat(parseInt(num / 10000) + '.' + decimal) + '万'
      } else if (numStr.length &gt; 8) {
        let decimal = numStr.substring(numStr.length - 8, numStr.length - 8 - point)
        return parseFloat(parseInt(num / 100000000) + '.' + decimal) + '亿'
      }
}
</code></pre></div><h2 id="高斯模糊"><a href="#高斯模糊" class="header-anchor">#</a> 高斯模糊</h2> <div class="language- extra-class"><pre class="language-text"><code>.detail-container {
  height: 320rpx;
  filter: blur(40rpx);
  opacity: 0.4;
}
</code></pre></div><p>底下再用定位盖一层底色</p> <h2 id="storage"><a href="#storage" class="header-anchor">#</a> storage</h2> <div class="language- extra-class"><pre class="language-text"><code>wx.setStorageSync('musiclist', this.data.musiclist)

wx.getStorageSync('musiclist')
</code></pre></div><p>有分同步异步</p> <h2 id="上拉加载"><a href="#上拉加载" class="header-anchor">#</a> 上拉加载</h2> <ol><li><p>在对应页面的json文件中加上</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;enablePullDownRefresh&quot;: true
</code></pre></div></li> <li><p>在钩子中</p> <div class="language- extra-class"><pre class="language-text"><code>onReachBottom: function () {
    this._getPLaylist()
  },
</code></pre></div></li></ol> <h2 id="下拉刷新"><a href="#下拉刷新" class="header-anchor">#</a> 下拉刷新</h2> <p>在对应钩子里</p> <div class="language- extra-class"><pre class="language-text"><code>onPullDownRefresh: function () {
    this.setData({
      playlist: []
    })
    this._getPLaylist()
    this._getSwiper()
  },
</code></pre></div><p>获取到数据后</p> <div class="language- extra-class"><pre class="language-text"><code>wx.stopPullDownRefresh()
</code></pre></div><p>将上方加载动画收回</p> <h2 id="全局组件"><a href="#全局组件" class="header-anchor">#</a> 全局组件</h2> <ol><li><p>loading</p> <div class="language- extra-class"><pre class="language-text"><code>wx.showLoading({
      title: '加载中'
        mask: true,
})
wx.hideLoading()
</code></pre></div></li> <li><p>modal</p> <div class="language- extra-class"><pre class="language-text"><code>wx.showModal({
      title: '授权用户才能发布',
      content: '',
    })
</code></pre></div></li></ol> <h2 id="配置分享"><a href="#配置分享" class="header-anchor">#</a> 配置分享</h2> <div class="language- extra-class"><pre class="language-text"><code>在钩子函数
onShareAppMessage: function (event) {
    let blogObj = event.target.dataset.blog
    return {
      title: blogObj.content,
      path: `/pages/blog-comment/blog-comment?blogId=${blogObj._id}`
    }
  }
</code></pre></div><h3 id="按钮触发"><a href="#按钮触发" class="header-anchor">#</a> 按钮触发</h3> <div class="language- extra-class"><pre class="language-text"><code>&lt;button open-type=&quot;share&quot; data-blogid=&quot;{{blogId}}&quot; data-blog=&quot;{{blog}}&quot; class=&quot;share-btn&quot; hover-class=&quot;share-hover&quot;&gt;
      &lt;i class=&quot;iconfont icon-fenxiang icon&quot;&gt;&lt;/i&gt;
      &lt;text&gt;分享&lt;/text&gt;
    &lt;/button&gt;
</code></pre></div><h2 id="图片"><a href="#图片" class="header-anchor">#</a> 图片</h2> <h3 id="上传"><a href="#上传" class="header-anchor">#</a> 上传</h3> <div class="language- extra-class"><pre class="language-text"><code>wx.chooseImage({
      count: MAX_IMG_NUM - this.data.images.length,
      sizeType: ['orginal', 'compressed'],
      sourceType: ['album', 'camera'],
      success: (res) =&gt; {
        console.log(res)
        this.setData({
          images: this.data.images.concat(res.tempFilePaths),
        })
        this.showAddImg()
      },
    })
</code></pre></div><h3 id="预览"><a href="#预览" class="header-anchor">#</a> 预览</h3> <div class="language- extra-class"><pre class="language-text"><code>wx.previewImage({
      urls: this.data.images,
      current: event.target.dataset.imgsrc
    })
</code></pre></div><h3 id="上传到云存储"><a href="#上传到云存储" class="header-anchor">#</a> 上传到云存储</h3> <div class="language- extra-class"><pre class="language-text"><code>wx.cloud.uploadFile({
          cloudPath: 'blog/' + Date.now() + '-' + Math.random() * 10000000 + suffix,
          filePath: item,
          success: (res) =&gt; {
            // console.log(res)
            fileIds = fileIds.concat(res.fileID)
            resolve(res)
          },
          fail: err =&gt; {
            console.log(err)
            reject(err)
          }
        })
</code></pre></div><h2 id="获取上一页面"><a href="#获取上一页面" class="header-anchor">#</a> 获取上一页面</h2> <div class="language- extra-class"><pre class="language-text"><code>const pages = getCurrentPages()
        const prevPage = pages[pages.length - 2]
        prevPage.onPullDownRefresh()
</code></pre></div><h2 id="配置订阅消息"><a href="#配置订阅消息" class="header-anchor">#</a> 配置订阅消息</h2> <h3 id="dom"><a href="#dom" class="header-anchor">#</a> dom</h3> <div class="language- extra-class"><pre class="language-text"><code>&lt;form slot=&quot;modal-content&quot; report-submit=&quot;true&quot; bind:submit=&quot;onSend&quot;&gt;
    &lt;textarea name=&quot;content&quot; class=&quot;comment-content&quot; placeholder=&quot;写评论&quot; value=&quot;{{content}}&quot; fixed=&quot;true&quot;&gt;&lt;/textarea&gt;
    &lt;button class=&quot;send&quot; form-type=&quot;submit&quot;&gt;发送&lt;/button&gt;
  &lt;/form&gt;
</code></pre></div><h3 id="点击获取权限"><a href="#点击获取权限" class="header-anchor">#</a> 点击获取权限</h3> <div class="language- extra-class"><pre class="language-text"><code>wx.requestSubscribeMessage({
        tmplIds: ['ygpQMok-53skEfgTXGMNEX3lBCAVNFKasRLvDnE-y5U'],
        success(res) {
        }
      })
</code></pre></div><h3 id="云函数"><a href="#云函数" class="header-anchor">#</a> 云函数</h3> <p>config.json</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;permissions&quot;: {
    &quot;openapi&quot;: [
      &quot;subscribeMessage.send&quot;
    ]
  }
}

</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>const { OPENID } = cloud.getWXContext()
  const db = cloud.database()
  try {
    const result = await cloud.openapi.subscribeMessage.send({
      touser: OPENID,
      page: `/pages/blog-comment/blog-comment?blogId=${event.blogId}`,
      data: {
        phrase2: {
          value: event.content
        },
        time1: {
          value: fmtTime(new Date())
        }
      },
      templateId: 'ygpQMok-53skEfgTXGMNEX3lBCAVNFKasRLvDnE-y5U'
    })
    console.log(result)
    return result
  } catch (err) {
    console.log(err)
    return err
  }
</code></pre></div><h2 id="data"><a href="#data" class="header-anchor">#</a> data</h2> <p>要显示到页面上的才放到data中，不显示的在外面定义变量</p> <p>取法</p> <div class="language- extra-class"><pre class="language-text"><code>this.data.xx
</code></pre></div><p>设置</p> <div class="language- extra-class"><pre class="language-text"><code>this.setData({
	xx: xx
})

this.setData({
        loginShow: false,
      }, () =&gt; {
        this.setData({
          modalShow: true,
        })
      })
</code></pre></div><p>不能频繁setData，会触发页面重绘</p> <h2 id="引入async-await"><a href="#引入async-await" class="header-anchor">#</a> 引入async await</h2> <p>runtime.js 见代码</p> <h2 id="调取云函数"><a href="#调取云函数" class="header-anchor">#</a> 调取云函数</h2> <div class="language- extra-class"><pre class="language-text"><code>wx.cloud.callFunction({
      name: 'music',
      data: {
        $url: 'playlist',
        start: this.data.playlist.length,
        count: MAX_LIMIT
      }
    }).then(res =&gt; {
      console.log(res)
      this.setData({
        playlist: this.data.playlist.concat(res.result.data)
      })
      wx.stopPullDownRefresh()
      wx.hideLoading()
    })
</code></pre></div><p>$url 引入了tcb-router时 对应的router</p> <h2 id="限制一次100条"><a href="#限制一次100条" class="header-anchor">#</a> 限制一次100条</h2> <p>先判断长度，循环取出来拼接起来</p> <h1 id="云函数-2"><a href="#云函数-2" class="header-anchor">#</a> 云函数</h1> <h2 id="最多50个-tcb-router"><a href="#最多50个-tcb-router" class="header-anchor">#</a> 最多50个 tcb-router</h2> <div class="language- extra-class"><pre class="language-text"><code>npm i tcb-router
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>// 云函数入口文件
const cloud = require('wx-server-sdk')
const TcbRouter = require('tcb-router')
cloud.init()

// 云函数入口函数
exports.main = async (event, context) =&gt; {
  const app = new TcbRouter({ event })

  app.router('playlist', async (ctx, next) =&gt; {
    ctx.body = await cloud.database().collection('playlist')
      .skip(event.start)
      .limit(event.count)
      .orderBy('createTime', 'desc')
      .get()
      .then(res =&gt; {
        return res
      })
  })

  return app.serve()
}
</code></pre></div><h2 id="模糊搜索"><a href="#模糊搜索" class="header-anchor">#</a> 模糊搜索</h2> <div class="language- extra-class"><pre class="language-text"><code>w = {
        content: db.RegExp({
          regexp: keyword,
          options: 'i'
        })
      }
      
      
.where(w)
</code></pre></div><h2 id="定时运行"><a href="#定时运行" class="header-anchor">#</a> 定时运行</h2> <p>config.json</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;triggers&quot;: [
    {
      &quot;name&quot;: &quot;myTrigger&quot;,
      &quot;type&quot;: &quot;timer&quot;,
      &quot;config&quot;: &quot;0 0 10,14,16,23 * * * *&quot;
    }
  ]
}
</code></pre></div><h2 id="ajax请求"><a href="#ajax请求" class="header-anchor">#</a> ajax请求</h2> <div class="language- extra-class"><pre class="language-text"><code>npm i request request-promise

const rp = require('request-promise')
rp(url)
</code></pre></div><h2 id="生成小程序码"><a href="#生成小程序码" class="header-anchor">#</a> 生成小程序码</h2> <p>云函数</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;permissions&quot;: {
    &quot;openapi&quot;: [
      &quot;wxacode.getUnlimited&quot;
    ]
  }
}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>const wxContext = cloud.getWXContext()
  const result = await cloud.openapi.wxacode.getUnlimited({
    scene: wxContext.OPENID
    // lineColor: {
    //   'r': 211,
    //   'g': 60,
    //   'b': 57
    // },
    // isHyaline: true
  })
  const upload = await cloud.uploadFile({
    cloudPath: 'qrcode/' + Date.now() + '-' + Math.random() + '.png',
    fileContent: result.buffer
  })
  return upload.fileID
</code></pre></div><h1 id="后台系统"><a href="#后台系统" class="header-anchor">#</a> 后台系统</h1> <p>前后端分离</p> <h2 id="前端"><a href="#前端" class="header-anchor">#</a> 前端</h2> <p>使用vue ,vue-admin-template搭建</p> <p>改下路由、view下新增自己的页面就可以使用了</p> <h3 id="滑动加载更多"><a href="#滑动加载更多" class="header-anchor">#</a> 滑动加载更多</h3> <div class="language- extra-class"><pre class="language-text"><code>const scroll = {
    isEnd: false,
    start(callback) {
        let timer = null
        callback &amp;&amp; window.addEventListener('scroll', () =&gt; {
            if (timer) {
                clearTimeout(timer)
            }
            // 函数防抖
            timer = setTimeout(() =&gt; {
                // 浏览器向上滚动的高度
                const scrollTop = document.documentElement.scrollTop || document.body.scrollTop
                // 文档的真实高度
                const scrollHeight = document.documentElement.scrollHeight
                // 浏览器窗口（文档）的可视高度,就是肉眼可见的那部分全屏高度
                const clientHeight = document.documentElement.clientHeight
                if (!this.isEnd &amp;&amp; scrollHeight == scrollTop + clientHeight) {
                    window.scrollTo(0, scrollTop - 100)
                    // 请求数据
                    callback()
                }
            }, 300)
        })
    },
    end() {
        this.isEnd = true
    }
}

export default scroll


</code></pre></div><h3 id="api放统一文件夹中"><a href="#api放统一文件夹中" class="header-anchor">#</a> api放统一文件夹中</h3> <p>举个例子</p> <div class="language- extra-class"><pre class="language-text"><code>import request from '@/utils/request'
const baseUrl = 'http://localhost:3000'

export function fetchList (params) {
    return request({
        url: `${baseUrl}/blog/list`,
        method: 'get',
        params
    })
}

export function del (params) {
    return request({
        url: `${baseUrl}/blog/del`,
        method: 'post',
        data: {
            ...params
        }
    })
}
</code></pre></div><h2 id="后端"><a href="#后端" class="header-anchor">#</a> 后端</h2> <h3 id="获取token"><a href="#获取token" class="header-anchor">#</a> 获取token</h3> <div class="language- extra-class"><pre class="language-text"><code>const rp = require('request-promise')
const APPID = 'xx'
const APPSECRET = 'xx'
const URL = `https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=${APPID}&amp;secret=${APPSECRET}`

const fs = require('fs')
const path = require('path')
const fileName = path.resolve(__dirname, './access_token.json')
const updateAccessToken = async () =&gt; {
    const resStr = await rp(URL)
    const res = JSON.parse(resStr)
    // console.log(res)
    if(res.access_token) {
        fs.writeFileSync(fileName, JSON.stringify({
            access_token: res.access_token,
            createTime: new Date()
        }))
    } else {
        await updateAccessToken()
    }
}

const getAccessToken = async () =&gt; {
    try {
        const readRes = fs.readFileSync(fileName, 'utf8')
        const readObj = JSON.parse(readRes)

        const createTime = new Date(readObj.createTime).getTime()
        const now = new Date().getTime()
        if ((now - createTime) / 1000 / 60 / 60 &gt;= 2) {
            await updateAccessToken()
            await getAccessToken()
        }
        return readObj.access_token
    } catch (error) {
        await updateAccessToken()
        await getAccessToken()
    }
}

setInterval(async () =&gt; {
    await updateAccessToken()
}, (7200 - 300) * 1000)

module.exports = getAccessToken
</code></pre></div><h3 id="调用云数据库、"><a href="#调用云数据库、" class="header-anchor">#</a> 调用云数据库、</h3> <div class="language- extra-class"><pre class="language-text"><code>const getAccessToeken = require('../utils/getAccessToken')
const rp = require('request-promise')

const callCloudDB = async (ctx, fnName, query = {}) =&gt; {
    const access_token = await getAccessToeken()
    const url = `https://api.weixin.qq.com/tcb/${fnName}?access_token=${access_token}`

    const options = {
        method: 'POST',
        uri: url,
        body: {
            query,
            env: ctx.state.env
        },
        json: true // Automatically stringifies the body to JSON
    };
    
    return await rp(options)
        .then((res) =&gt; {
            return res
        })
        .catch(function (err) {
            // POST failed...
        });
}

module.exports = callCloudDB
</code></pre></div><h3 id="调用云函数"><a href="#调用云函数" class="header-anchor">#</a> 调用云函数</h3> <div class="language- extra-class"><pre class="language-text"><code>const getAccessToeken = require('../utils/getAccessToken')
const rp = require('request-promise')


const callCloudFn = async (ctx, fnName, params) =&gt; {
    const access_token = await getAccessToeken()
    const url = `https://api.weixin.qq.com/tcb/invokecloudfunction?access_token=${access_token}&amp;env=${ctx.state.env}&amp;name=${fnName}`

    const options = {
        method: 'POST',
        uri: url,
        body: params,
        json: true // Automatically stringifies the body to JSON
    };
    
    return await rp(options)
        .then((res) =&gt; {
            return res
        })
        .catch(function (err) {
            // POST failed...
        });
}

module.exports = callCloudFn
</code></pre></div><h3 id="调用云存储"><a href="#调用云存储" class="header-anchor">#</a> 调用云存储</h3> <div class="language- extra-class"><pre class="language-text"><code>const getAccessToeken = require('../utils/getAccessToken')
const rp = require('request-promise')

const callCloudDB = async (ctx, fnName, query = {}) =&gt; {
    const access_token = await getAccessToeken()
    const url = `https://api.weixin.qq.com/tcb/${fnName}?access_token=${access_token}`

    const options = {
        method: 'POST',
        uri: url,
        body: {
            ...query,
            env: ctx.state.env
        },
        json: true // Automatically stringifies the body to JSON
    };
    
    return await rp(options)
        .then((res) =&gt; {
            return res
        })
        .catch(function (err) {
            // POST failed...
        });
}

module.exports = callCloudDB
</code></pre></div><h3 id="业务逻辑"><a href="#业务逻辑" class="header-anchor">#</a> 业务逻辑</h3> <p>举个例子</p> <div class="language- extra-class"><pre class="language-text"><code>const Router = require('koa-router')
const router = new Router()
const callCloudDB = require('../utils/callCloudDB')
const callCloudStorage = require('../utils/callCloudStorage')
const fs = require('fs')
const rp = require('request-promise')

router.get('/list', async (ctx, next) =&gt; {    
    const params = ctx.request.query
    const query = `db.collection('blog').skip(${params.start}).limit(${params.count}).orderBy('createTime', 'desc').get()`
    const res = await callCloudDB(ctx, 'databasequery', query)
    // console.log(res)
    ctx.body = {
        data: res.data,
        code: 20000
    }
})

router.post('/del', async (ctx, next) =&gt; {    
    const params = ctx.request.body
    console.log(params)
    // 删数据库
    const query = `db.collection('blog').doc('${params._id}').remove()`
    const res = await callCloudDB(ctx, 'databasedelete', query)
    // 删评论
    const commentQuery = `db.collection('blog-comment').where({
        blogId: '${params._id}'
    }).remove()`
    const commentRes = await callCloudDB(ctx, 'databasedelete', commentQuery)
    // 删相片
    let fileResult = {}
    if (params.img &amp;&amp; params.img.length &gt; 0) {
        fileResult = await callCloudStorage(ctx, 'batchdeletefile', {
            fileid_list: [params.img]
        })
    }
    ctx.body = {
        data: {
            res,
            commentRes,
            fileResult
        },
        code: 20000
    }
})

module.exports = router
</code></pre></div><h3 id="跨域问题"><a href="#跨域问题" class="header-anchor">#</a> 跨域问题</h3> <div class="language- extra-class"><pre class="language-text"><code>npm i koa2-cors

const cors = require('koa2-cors')

app.use(cors({
    origin: ['http://localhost:9528'],
    credentials: true
}))
</code></pre></div><h3 id="post请求"><a href="#post请求" class="header-anchor">#</a> post请求</h3> <div class="language- extra-class"><pre class="language-text"><code>npm i koa-body

const koaBody = require('koa-body')

app.use(koaBody({
    multipart: true
}))
</code></pre></div><h3 id="中间件"><a href="#中间件" class="header-anchor">#</a> 中间件</h3> <div class="language- extra-class"><pre class="language-text"><code>app.use(async (ctx, next) =&gt; {
    console.log('全局中间件')
    ctx.state.env = ENV
    await next()
})
</code></pre></div><h3 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h3> <div class="language- extra-class"><pre class="language-text"><code>npm i kia-router

const Router = require('koa-router')
const router = new Router()

const playlist = require('./controller/playlist')
const swiper = require('./controller/swiper')
const blog = require('./controller/blog')
router.use('/playlist', playlist.routes())
router.use('/swiper', swiper.routes())
router.use('/blog', blog.routes())

app.use(router.routes())
app.use(router.allowedMethods())
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-blog/assets/js/app.d2e1425f.js" defer></script><script src="/vuepress-blog/assets/js/2.52cbf88a.js" defer></script><script src="/vuepress-blog/assets/js/86.a2a0c8d1.js" defer></script>
  </body>
</html>
