(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{519:function(t,s,a){"use strict";a.r(s);var e=a(38),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"通过eslint限制使用高版本语法-避免报错"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过eslint限制使用高版本语法-避免报错"}},[t._v("#")]),t._v(" 通过eslint限制使用高版本语法，避免报错")]),t._v(" "),s("h2",{attrs:{id:"背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),s("p",[t._v("项目是使用vite进行打包的。vite打包时不会做低版本api的兼容处理，导致在chrome 80版本，会出现报错。")]),t._v(" "),s("p",[t._v("理想做法是打包时加上低版本的兼容转换代码，但是改打包的话影响很大，且会加大包体积。")]),t._v(" "),s("p",[t._v("既然决定不做兼容转换处理，那就只有手动改成浏览器支持的api了，但是可能别人不知道这回事，导致下次又出现这个bug，被提td。")]),t._v(" "),s("h2",{attrs:{id:"解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[t._v("#")]),t._v(" 解决方案")]),t._v(" "),s("h3",{attrs:{id:"手写eslint限制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手写eslint限制"}},[t._v("#")]),t._v(" 手写eslint限制")]),t._v(" "),s("p",[t._v("想到的提示方案就是通过eslint去限制")]),t._v(" "),s("p",[t._v("在"),s("code",[t._v(".eslintrc.js")]),t._v("的rules中添加以下限制")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"no-restricted-syntax"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"selector"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"CallExpression[callee.object.name='Object'][callee.property.name='hasOwn']\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"message"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Object.hasOwn在低版本有兼容性问题，请不要使用"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("p",[t._v("在编码时，如果使用了"),s("code",[t._v("Object.hasOwn")]),t._v("，则会告警提示，这样就避免了使用不支持的api，但是要限制的api实在是太多了，于是有了下面的方案")]),t._v(" "),s("h3",{attrs:{id:"eslint-plugin-es-x"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eslint-plugin-es-x"}},[t._v("#")]),t._v(" eslint-plugin-es-x")]),t._v(" "),s("p",[t._v("这是一个开源项目，专门收集了各版本的js语法、api，并内置了eslint的限制")]),t._v(" "),s("p",[t._v("我们只需要安装后")]),t._v(" "),s("p",[t._v("在"),s("code",[t._v(".eslintrc.js")]),t._v("的添加以下规则")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"plugin:es-x/restrict-to-es2020"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("parserOptions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("project")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tsconfig.json"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("p",[t._v("这里查了下，es2020版本基本对应上chrome的80版本，所以限制在es2020")]),t._v(" "),s("p",[t._v("这样简单配置后，就实现了超过2020的api都不让用，避免浏览器不支持")])])}),[],!1,null,null,null);s.default=r.exports}}]);