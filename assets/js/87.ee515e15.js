(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{496:function(t,s,a){"use strict";a.r(s);var n=a(38),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"webui开发环境性能优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webui开发环境性能优化"}},[t._v("#")]),t._v(" webui开发环境性能优化")]),t._v(" "),s("p",[t._v("目前webui开发环境使用的是vite3，由于项目代码数量极多，开发环境已经越来越卡顿，刷新通常需要30s（电脑刚重启且只跑webui项目）~60s（开了很多东西且几天没重启了），vite配置变更的重跑甚至需要8~10min，已严重影响了开发效率。")]),t._v(" "),s("h2",{attrs:{id:"升级vite4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级vite4"}},[t._v("#")]),t._v(" 升级vite4")]),t._v(" "),s("p",[t._v("首先要做的就是把vite及相关包升级到最新版本")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"dependencies"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"vue"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^3.3.4"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"devDependencies"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@rollup/plugin-yaml"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^4.1.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@vitejs/plugin-basic-ssl"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^1.0.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@vitejs/plugin-vue"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^4.2.3"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@vitejs/plugin-vue-jsx"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^3.0.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"unplugin-vue-components"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^0.25.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"vite"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^4.4.9"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"vite-plugin-http2-proxy"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^0.4.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"vite-tsconfig-paths"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^4.2.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("将vite升级后会提示需要更新的包，照着升级即可。")]),t._v(" "),s("h3",{attrs:{id:"报错"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#报错"}},[t._v("#")]),t._v(" 报错")]),t._v(" "),s("p",[t._v("热更新时，碰上keep-alive的组件会报错，排查后发现是vue的问题，升级新版即可解决")]),t._v(" "),s("h2",{attrs:{id:"优化vite配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化vite配置"}},[t._v("#")]),t._v(" 优化vite配置")]),t._v(" "),s("p",[t._v("由于vite本地模式是通过esmodule加载文件，这样会产生加载很多个文件的问题。所以vite提供了优化项："),s("code",[t._v("optimizeDeps")]),t._v("，配置了的包会被vite进行预构建，比如lodash，不打包的话会产生600+请求，打包后就只有一个了，能大大节省加载时间")]),t._v(" "),s("p",[t._v("示例如下：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    optimizeDeps"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      include"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n          '@idux/components/xxx'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          '@idux/cdk/xxx'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          '@idux/pro/xxx'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          '@uedc/ixs-components/xxx'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          'date-fns'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          '@uedc/ixs-charts'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          '@uedc/ixs-flow'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          '@uedc/ixs-utils'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          '@uedc/ixs-pro/xxx'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          'dayjs'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          'echarts'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          'echarts/core'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          'echarts/charts'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          'echarts/components'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          'echarts/renderers'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          'lodash-es'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          'pinia'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          'qs'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          'vue'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          'vue-router'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          'vue-types'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          '@antv/x6'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("主要是将会产生多个文件的包进行优化。")]),t._v(" "),s("h3",{attrs:{id:"特殊情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特殊情况"}},[t._v("#")]),t._v(" 特殊情况")]),t._v(" "),s("h4",{attrs:{id:"date-fns"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#date-fns"}},[t._v("#")]),t._v(" date-fns")]),t._v(" "),s("p",[s("code",[t._v("date-fns")]),t._v("这个包是"),s("code",[t._v("@uedc/ixs-components")]),t._v("中用到的，但是ixs并没有打包，webui项目中也没用到"),s("code",[t._v("date-fns")]),t._v("，所以导致配置了优化项也不生效。")]),t._v(" "),s("p",[t._v("这里通过在webui中安装"),s("code",[t._v("date-fns")]),t._v("包解决，由于项目中并没有引用该包，所以并不会增加包体积。")]),t._v(" "),s("h4",{attrs:{id:"echarts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#echarts"}},[t._v("#")]),t._v(" echarts")]),t._v(" "),s("p",[t._v("echarts需要加上子项，不然优化不到")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("'echarts/core'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n'echarts/charts'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n'echarts/components'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n'echarts/renderers'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("h4",{attrs:{id:"antv-x6"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#antv-x6"}},[t._v("#")]),t._v(" antv-x6")]),t._v(" "),s("p",[t._v("之前在vite3中，添加到优化项会导致报错，现在意外发现不会报错了")]),t._v(" "),s("h2",{attrs:{id:"优化后效果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化后效果"}},[t._v("#")]),t._v(" 优化后效果")]),t._v(" "),s("p",[t._v("首次加载：从"),s("code",[t._v("8.3min")]),t._v(" 降低至 "),s("code",[t._v("2.2min")]),t._v("，性能提升"),s("code",[t._v("377%")]),t._v("。")]),t._v(" "),s("p",[t._v("刷新：从"),s("code",[t._v("29s")]),t._v("降低至"),s("code",[t._v("10s")]),t._v("，性能提升"),s("code",[t._v("290%")]),t._v("。")]),t._v(" "),s("p",[t._v("通过以上优化，大大减少了开发环境的更新时间，又可以愉快的写代码了。")]),t._v(" "),s("h2",{attrs:{id:"未完成项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#未完成项"}},[t._v("#")]),t._v(" 未完成项")]),t._v(" "),s("p",[t._v("由于webui是个老项目，项目中存在大量ext的组件代码，在非ext的页面也会存在787个需要加载的ext文件，如果能优化了，肯定又能节省几秒钟。")]),t._v(" "),s("p",[t._v("针对vite优化项的思路，给"),s("code",[t._v("src/ext2vue/entry")]),t._v("文件夹加上"),s("code",[t._v("package.json")]),t._v("，假装其是一个外部包，")]),t._v(" "),s("p",[t._v("然后在vite优化项中加入该包名，")]),t._v(" "),s("p",[t._v("同时在项目的"),s("code",[t._v("package.json")]),t._v("中写上该包名"),s("code",[t._v('"ext-entry": "link:src/ext2vue/entry"')]),t._v("并"),s("code",[t._v("pnpm i")])]),t._v(" "),s("p",[t._v("理论上没问题，但是会报找不到文件，vite在这里不认识配置"),s("code",[t._v("alias")]),t._v("，暂未找到解决办法。")])])}),[],!1,null,null,null);s.default=e.exports}}]);