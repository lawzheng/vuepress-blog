(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{450:function(t,e,n){"use strict";n.r(e);var a=n(38),r=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"优化复制功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化复制功能"}},[t._v("#")]),t._v(" 优化复制功能")]),t._v(" "),e("h2",{attrs:{id:"背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),e("p",[t._v("最近遇到个复制的需求，在项目中找了下，发现存在写好的功能，于是直接调用，发现在chrome下居然是弹窗让我手动复制，于是看了下源码，居然是兼容古老的浏览器写法，在现在这个环境下已经失去了意义，所以动手优化一下。")]),t._v(" "),e("h2",{attrs:{id:"实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[t._v("#")]),t._v(" 实现")]),t._v(" "),e("p",[t._v("为了不影响之前的功能，只能用兼容的写法，在之前的一堆if-else的倒数第二处加个自己的判断。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("if (window.clipboardData) {\n\txxx\n} else  if (navigator.userAgent.indexOf('Opera') != -1) {\n\txxx\n} else if (window.netscape) {\n\txxx\n} else if ($clipboard(content)) {\n\t在这里\n} else {\n\txxx\n}\n")])])]),e("p",[t._v("复制的逻辑主要参考了vue-clipboard2。")]),t._v(" "),e("p",[t._v("其主要原理就是创建一个textarea，将需要复制的值赋给textarea，然后选中，再执行复制操作"),e("code",[t._v("document.execCommand('copy')")]),t._v("即完成了操作。")]),t._v(" "),e("p",[t._v("注意下环境的兼容，ios设备上需要专门去选中textarea，才可以复制。")]),t._v(" "),e("p",[t._v("复制完将创建的内容都清了，避免内存泄漏。")]),t._v(" "),e("p",[t._v("主要改动在成功或失败都得返回结果告知上层函数，在失败时能走向最终的逻辑，也就是弹窗手动复制。")]),t._v(" "),e("p",[t._v("源码贴上")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("var $clipboard = function(input) {\n\tvar value;\n\tvar success = false;\n\t\n\tif (typeof input !== 'string') {\n\t\ttry {\n\t\t\tvalue = JSON.stringify(input);\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\t} else {\n\t\tvalue = input;\n\t}\n\t\n\tvar textarea = document.createElement('textarea');\n\t\n\ttextarea.value = value;\n\ttextarea.setAttribute('readonly', '');\n\ttextarea.style.cssText = 'position:fixed;pointer-events:none;z-index:-9999;opacity:0;';\n\t\n\tdocument.body.appendChild(textarea);\n\t\n\tif (navigator.userAgent.match(/ipad|ipod|iphone/i)) {\n\t\ttextarea.contentEditable = true;\n\t\ttextarea.readOnly = true;\n\t\t\n\t\tvar range = document.createRange();\n\t\t\n\t\trange.selectNodeContents(textarea);\n\t\t\n\t\tvar selection = window.getSelection();\n\t\t\n\t\tselection.removeAllRanges();\n\t\t// 让window选中textarea\n\t\tselection.addRange(range);\n\t\t// 设置textarea的光标选中位置为大致全部\n\t\ttextarea.setSelectionRange(0, 999999);\n\t} else {\n\t\ttextarea.select();\n\t}\n\t\n\ttry {\n\t\tsuccess = document.execCommand('copy');\n\t} catch (err) {\n\t\tconsole.warn(err);\n\t}\n\t\n\tdocument.body.removeChild(textarea);\n\t\n\treturn success;\n};\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);