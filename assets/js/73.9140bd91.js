(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{479:function(a,s,t){"use strict";t.r(s);var e=t(38),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"控制器自动打包拓扑图项目代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#控制器自动打包拓扑图项目代码"}},[a._v("#")]),a._v(" 控制器自动打包拓扑图项目代码")]),a._v(" "),s("h2",{attrs:{id:"背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[a._v("#")]),a._v(" 背景")]),a._v(" "),s("p",[a._v("目前拓扑图是个独立的项目，每次更改代码后需要打包->复制文件去控制器项目。")]),a._v(" "),s("p",[a._v("频繁地修改代码下这种方式是不可取的，于是在控制器的打包脚本中，增加将拓扑图打包到指定路径的逻辑，解决这种问题。")]),a._v(" "),s("h2",{attrs:{id:"实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[a._v("#")]),a._v(" 实现")]),a._v(" "),s("h3",{attrs:{id:"拉取拓扑图项目代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#拉取拓扑图项目代码"}},[a._v("#")]),a._v(" 拉取拓扑图项目代码")]),a._v(" "),s("p",[a._v("公司项目使用的"),s("code",[a._v("gitlab")]),a._v("，而"),s("code",[a._v("gitlab")]),a._v("拉取代码一般都通过生成个设备的秘钥，但是我们打包服务器通常不是固定的一台，所以通过注册一个个人"),s("code",[a._v("token")]),a._v("去拉取代码。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone http://oauth2:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("你的token"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("@code.sangfor.org/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("repo_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(".git\n")])])]),s("h3",{attrs:{id:"拉取node-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#拉取node-js"}},[a._v("#")]),a._v(" 拉取node.js")]),a._v(" "),s("p",[a._v("因为公司是内网环境，不能直接拉取公网的node.js包，所以将node包下载好后放在svn服务器上（旧有逻辑），打包时拉取下来")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("svn "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" svn://path "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--force")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--force")]),a._v("  --no-auth-cache\n")])])]),s("p",[a._v("拉下来后解压")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('">> tar -xvf..."')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-xvf")]),a._v(" ./node-v16.15.0-linux-x64.tar.xz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" ./node-v16.15.0-linux-x64.tar.xz\n")])])]),s("p",[a._v("修改权限")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('">> chmod node"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x ./node-v16.15.0-linux-x64/bin/*\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$?")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ne")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"chmod node error!"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exit")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n")])])]),s("p",[a._v("添加临时环境变量（重点）")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PWD")]),a._v("/node-v16.15.0-linux-x64/bin\n")])])]),s("p",[a._v("因为不需要安装node到环境中，所以这里添加node到临时环境变量中，只在本线程中生效")]),a._v(" "),s("h3",{attrs:{id:"安装项目依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装项目依赖"}},[a._v("#")]),a._v(" 安装项目依赖")]),a._v(" "),s("p",[a._v("因为公司内网搭建了自己的npm服务器，所以这里先要切换下npm服务器路径再进行安装")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('">> npm registry"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" config "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" registry http://path\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('">> npm install..."')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('">> npm run build..."')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" run build\n")])])]),s("h3",{attrs:{id:"复制打包文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#复制打包文件"}},[a._v("#")]),a._v(" 复制打包文件")]),a._v(" "),s("p",[a._v("打包好后复制文件到所需文件夹路径即可")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('">> copy dist"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" UED-Graph/dist/* ./WLAN/js/components/vendor/topo\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('">> delete UED-Graph"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" ./UED-Graph\n")])])]),s("h2",{attrs:{id:"遇到的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题"}},[a._v("#")]),a._v(" 遇到的问题")]),a._v(" "),s("h3",{attrs:{id:"shell文件格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#shell文件格式"}},[a._v("#")]),a._v(" shell文件格式")]),a._v(" "),s("p",[a._v("因为是在windows下进行的编写，所以传到linux后运行时会报格式问题")]),a._v(" "),s("p",[a._v("进vim修改下格式即可。")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v(":set "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("fileformat")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("unix\n:wq\n")])])]),s("h3",{attrs:{id:"报错glibc-2-16-not-found"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#报错glibc-2-16-not-found"}},[a._v("#")]),a._v(" 报错GLIBC_2.16 not found")]),a._v(" "),s("p",[a._v("这是因为Jenkins环境老旧")]),a._v(" "),s("p",[a._v("打包流水线不止是打包前端代码，还有硬件那边的代码，环境依赖不敢随便升级")]),a._v(" "),s("p",[a._v("这联系后台人员去处理了")])])}),[],!1,null,null,null);s.default=n.exports}}]);